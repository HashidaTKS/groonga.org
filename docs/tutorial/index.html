<!DOCTYPE html>

<html lang="en">
  <head>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-7532323-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-7532323-1');
    </script>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>4.6. Tag search and reverse resolution of reference relationships &#8212; Groonga v11.0.3 documentation</title>
    <link rel="stylesheet" type="text/css" href="../static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../static/groonga.css" />
    
    <script data-url_root="../" id="documentation_options" src="../static/documentation_options.js"></script>
    <script src="../static/jquery.js"></script>
    <script src="../static/underscore.js"></script>
    <script src="../static/doctools.js"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4.7. match_columns parameter" href="match_columns.html" />
    <link rel="prev" title="4.5. Drilldown" href="drilldown.html" /> 
      <meta property="fb:page_id" content="201193596592346" /><!-- groonga -->
    <meta property="fb:admins" content="664204556" /><!-- kouhei.sutou -->
    <meta property="og:type" content="product" />
    <meta property="og:image" content="http://groonga.org/images/logos/groonga-icon-full-size.png" />
    <meta property="og:site_name" content="groonga" />

    <link rel="stylesheet" href="/css/sphinx.css" type="text/css" />
  </head>
  <body>
    <div id="fb-root"></div>

<div class="header">
  <h1 class="title">
    <a id="top-link" href="../../">
      <span class="project">groonga</span>
      <span class="separator">-</span>
      <span class="description">An open-source fulltext search engine and column store.</span>
    </a>
  </h1>

      <div class="facebook-buttons">
      <fb:like href="http://www.facebook.com/pages/groonga/201193596592346"
               layout="standard"
               width="290"></fb:like>
    </div>
    <div class="other-language-links">

    <ul>
      <li><a href="../../ja/docs/tutorial/index.html">日本語</a></li>
    </ul>
  </div>
</div>
  

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="match_columns.html" title="4.7. match_columns parameter"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="drilldown.html" title="4.5. Drilldown"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Groonga v11.0.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../tutorial.html" accesskey="U"><span class="section-number">4. </span>Tutorial</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">4.6. </span>Tag search and reverse resolution of reference relationships</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tag-search-and-reverse-resolution-of-reference-relationships">
<h1><span class="section-number">4.6. </span>Tag search and reverse resolution of reference relationships<a class="headerlink" href="#tag-search-and-reverse-resolution-of-reference-relationships" title="Permalink to this headline">¶</a></h1>
<p>As you know, Groonga supports to store array in column which refers other table.
In fact, you can do tag search by using array data which refers other table.</p>
<p>Tag search is very fast because Groonga use inverted index as data structure.</p>
<div class="section" id="tag-search">
<h2><span class="section-number">4.6.1. </span>Tag search<a class="headerlink" href="#tag-search" title="Permalink to this headline">¶</a></h2>
<p>Let’s consider to create a search engine for an web site to share movies. Each movie may be associated with multiple keywords which represents the content of movie.</p>
<p>Let’s create tables for movie information, then search the movies.</p>
<p>First, create the <code class="docutils literal notranslate"><span class="pre">Video</span></code> table which stores movie information. the <code class="docutils literal notranslate"><span class="pre">Video</span></code> table has two columns. the <code class="docutils literal notranslate"><span class="pre">title</span></code> column stores title of the movie. the <code class="docutils literal notranslate"><span class="pre">tags</span></code> column stores multiple tag information in reference Tag table.</p>
<p>Next, create the <code class="docutils literal notranslate"><span class="pre">Tag</span></code> table which stores tag information. the <code class="docutils literal notranslate"><span class="pre">Tag</span></code> table has one column. The tag string is stored as primary key, then <code class="docutils literal notranslate"><span class="pre">index_tags</span></code> stores indexes for tags column of Video table.</p>
<p>Execution example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="o">--</span><span class="n">name</span> <span class="n">Video</span> <span class="o">--</span><span class="n">flags</span> <span class="n">TABLE_HASH_KEY</span> <span class="o">--</span><span class="n">key_type</span> <span class="n">UInt32</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">table_create</span> <span class="o">--</span><span class="n">name</span> <span class="n">Tag</span> <span class="o">--</span><span class="n">flags</span> <span class="n">TABLE_HASH_KEY</span> <span class="o">--</span><span class="n">key_type</span> <span class="n">ShortText</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">Video</span> <span class="o">--</span><span class="n">name</span> <span class="n">title</span> <span class="o">--</span><span class="n">flags</span> <span class="n">COLUMN_SCALAR</span> <span class="o">--</span><span class="nb">type</span> <span class="n">ShortText</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">Video</span> <span class="o">--</span><span class="n">name</span> <span class="n">tags</span> <span class="o">--</span><span class="n">flags</span> <span class="n">COLUMN_VECTOR</span> <span class="o">--</span><span class="nb">type</span> <span class="n">Tag</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">Tag</span> <span class="o">--</span><span class="n">name</span> <span class="n">index_tags</span> <span class="o">--</span><span class="n">flags</span> <span class="n">COLUMN_INDEX</span> <span class="o">--</span><span class="nb">type</span> <span class="n">Video</span> <span class="o">--</span><span class="n">source</span> <span class="n">tags</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">Video</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;Soccer 2010&quot;</span><span class="p">,</span><span class="s2">&quot;tags&quot;</span><span class="p">:[</span><span class="s2">&quot;Sports&quot;</span><span class="p">,</span><span class="s2">&quot;Soccer&quot;</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;Zenigata Kinjirou&quot;</span><span class="p">,</span><span class="s2">&quot;tags&quot;</span><span class="p">:[</span><span class="s2">&quot;Variety&quot;</span><span class="p">,</span><span class="s2">&quot;Money&quot;</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;groonga Demo&quot;</span><span class="p">,</span><span class="s2">&quot;tags&quot;</span><span class="p">:[</span><span class="s2">&quot;IT&quot;</span><span class="p">,</span><span class="s2">&quot;Server&quot;</span><span class="p">,</span><span class="s2">&quot;groonga&quot;</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;Moero!! Ultra Baseball&quot;</span><span class="p">,</span><span class="s2">&quot;tags&quot;</span><span class="p">:[</span><span class="s2">&quot;Sports&quot;</span><span class="p">,</span><span class="s2">&quot;Baseball&quot;</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;Hex Gone!&quot;</span><span class="p">,</span><span class="s2">&quot;tags&quot;</span><span class="p">:[</span><span class="s2">&quot;Variety&quot;</span><span class="p">,</span><span class="s2">&quot;Quiz&quot;</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span><span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;Pikonyan 1&quot;</span><span class="p">,</span><span class="s2">&quot;tags&quot;</span><span class="p">:[</span><span class="s2">&quot;Animation&quot;</span><span class="p">,</span><span class="s2">&quot;Pikonyan&quot;</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span><span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;Draw 8 Month&quot;</span><span class="p">,</span><span class="s2">&quot;tags&quot;</span><span class="p">:[</span><span class="s2">&quot;Animation&quot;</span><span class="p">,</span><span class="s2">&quot;Raccoon&quot;</span><span class="p">]},</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span><span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;K.O.&quot;</span><span class="p">,</span><span class="s2">&quot;tags&quot;</span><span class="p">:[</span><span class="s2">&quot;Animation&quot;</span><span class="p">,</span><span class="s2">&quot;Music&quot;</span><span class="p">]}</span>
<span class="p">]</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], 8]</span>
</pre></div>
</div>
<p>After creating indexed column, you can do full-text search very fast. The indexed column is also automatically updated when stored data is refreshed.</p>
<p>List up the movies that specific keywords are given.</p>
<p>Execution example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">Video</span> <span class="o">--</span><span class="n">query</span> <span class="n">tags</span><span class="p">:</span><span class="nd">@Variety</span> <span class="o">--</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">title</span>
<span class="c1"># [</span>
<span class="c1">#   [</span>
<span class="c1">#     0,</span>
<span class="c1">#     1337566253.89858,</span>
<span class="c1">#     0.000355720520019531</span>
<span class="c1">#   ],</span>
<span class="c1">#   [</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         2</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_key&quot;,</span>
<span class="c1">#           &quot;UInt32&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;title&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         2,</span>
<span class="c1">#         &quot;Zenigata Kinjirou&quot;</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         5,</span>
<span class="c1">#         &quot;Hex Gone!&quot;</span>
<span class="c1">#       ]</span>
<span class="c1">#     ]</span>
<span class="c1">#   ]</span>
<span class="c1"># ]</span>
<span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">Video</span> <span class="o">--</span><span class="n">query</span> <span class="n">tags</span><span class="p">:</span><span class="nd">@Sports</span> <span class="o">--</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">title</span>
<span class="c1"># [</span>
<span class="c1">#   [</span>
<span class="c1">#     0,</span>
<span class="c1">#     1337566253.89858,</span>
<span class="c1">#     0.000355720520019531</span>
<span class="c1">#   ],</span>
<span class="c1">#   [</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         2</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_key&quot;,</span>
<span class="c1">#           &quot;UInt32&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;title&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         1,</span>
<span class="c1">#         &quot;Soccer 2010&quot;</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         4,</span>
<span class="c1">#         &quot;Moero!! Ultra Baseball&quot;</span>
<span class="c1">#       ]</span>
<span class="c1">#     ]</span>
<span class="c1">#   ]</span>
<span class="c1"># ]</span>
<span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">Video</span> <span class="o">--</span><span class="n">query</span> <span class="n">tags</span><span class="p">:</span><span class="nd">@Animation</span> <span class="o">--</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">title</span>
<span class="c1"># [</span>
<span class="c1">#   [</span>
<span class="c1">#     0,</span>
<span class="c1">#     1337566253.89858,</span>
<span class="c1">#     0.000355720520019531</span>
<span class="c1">#   ],</span>
<span class="c1">#   [</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         3</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_key&quot;,</span>
<span class="c1">#           &quot;UInt32&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;title&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         6,</span>
<span class="c1">#         &quot;Pikonyan 1&quot;</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         7,</span>
<span class="c1">#         &quot;Draw 8 Month&quot;</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         8,</span>
<span class="c1">#         &quot;K.O.&quot;</span>
<span class="c1">#       ]</span>
<span class="c1">#     ]</span>
<span class="c1">#   ]</span>
<span class="c1"># ]</span>
</pre></div>
</div>
<p>You can search by tags such as “Variety”, “Sports” and “Animation”.</p>
</div>
<div class="section" id="reverse-resolution-of-reference-relationships">
<h2><span class="section-number">4.6.2. </span>Reverse resolution of reference relationships<a class="headerlink" href="#reverse-resolution-of-reference-relationships" title="Permalink to this headline">¶</a></h2>
<p>Groonga supports indexes for reverse resolution among tables. Tag search is one of concrete examples.</p>
<p>For example, you can search friendships by reverse resolution in social networking site.</p>
<p>Following example shows how to create <code class="docutils literal notranslate"><span class="pre">User</span></code> table which stores user information, <code class="docutils literal notranslate"><span class="pre">username</span></code> column which stores user name, <code class="docutils literal notranslate"><span class="pre">friends</span></code> column which stores list of user’s friends in array, <code class="docutils literal notranslate"><span class="pre">index_friends</span></code> column as indexed column.</p>
<p>Execution example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="o">--</span><span class="n">name</span> <span class="n">User</span> <span class="o">--</span><span class="n">flags</span> <span class="n">TABLE_HASH_KEY</span> <span class="o">--</span><span class="n">key_type</span> <span class="n">ShortText</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">User</span> <span class="o">--</span><span class="n">name</span> <span class="n">username</span> <span class="o">--</span><span class="n">flags</span> <span class="n">COLUMN_SCALAR</span> <span class="o">--</span><span class="nb">type</span> <span class="n">ShortText</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">User</span> <span class="o">--</span><span class="n">name</span> <span class="n">friends</span> <span class="o">--</span><span class="n">flags</span> <span class="n">COLUMN_VECTOR</span> <span class="o">--</span><span class="nb">type</span> <span class="n">User</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">User</span> <span class="o">--</span><span class="n">name</span> <span class="n">index_friends</span> <span class="o">--</span><span class="n">flags</span> <span class="n">COLUMN_INDEX</span> <span class="o">--</span><span class="nb">type</span> <span class="n">User</span> <span class="o">--</span><span class="n">source</span> <span class="n">friends</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">User</span>
<span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;ken&quot;</span><span class="p">,</span><span class="s2">&quot;username&quot;</span><span class="p">:</span><span class="s2">&quot;健作&quot;</span><span class="p">,</span><span class="s2">&quot;friends&quot;</span><span class="p">:[</span><span class="s2">&quot;taro&quot;</span><span class="p">,</span><span class="s2">&quot;jiro&quot;</span><span class="p">,</span><span class="s2">&quot;tomo&quot;</span><span class="p">,</span><span class="s2">&quot;moritapo&quot;</span><span class="p">]}</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;moritapo&quot;</span><span class="p">,</span><span class="s2">&quot;username&quot;</span><span class="p">:</span><span class="s2">&quot;森田&quot;</span><span class="p">,</span><span class="s2">&quot;friends&quot;</span><span class="p">:[</span><span class="s2">&quot;ken&quot;</span><span class="p">,</span><span class="s2">&quot;tomo&quot;</span><span class="p">]}</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;taro&quot;</span><span class="p">,</span><span class="s2">&quot;username&quot;</span><span class="p">:</span><span class="s2">&quot;ぐるんが太郎&quot;</span><span class="p">,</span><span class="s2">&quot;friends&quot;</span><span class="p">:[</span><span class="s2">&quot;jiro&quot;</span><span class="p">,</span><span class="s2">&quot;tomo&quot;</span><span class="p">]}</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;jiro&quot;</span><span class="p">,</span><span class="s2">&quot;username&quot;</span><span class="p">:</span><span class="s2">&quot;ぐるんが次郎&quot;</span><span class="p">,</span><span class="s2">&quot;friends&quot;</span><span class="p">:[</span><span class="s2">&quot;taro&quot;</span><span class="p">,</span><span class="s2">&quot;tomo&quot;</span><span class="p">]}</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;tomo&quot;</span><span class="p">,</span><span class="s2">&quot;username&quot;</span><span class="p">:</span><span class="s2">&quot;トモちゃん&quot;</span><span class="p">,</span><span class="s2">&quot;friends&quot;</span><span class="p">:[</span><span class="s2">&quot;ken&quot;</span><span class="p">,</span><span class="s2">&quot;hana&quot;</span><span class="p">]}</span>
<span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;hana&quot;</span><span class="p">,</span><span class="s2">&quot;username&quot;</span><span class="p">:</span><span class="s2">&quot;花子&quot;</span><span class="p">,</span><span class="s2">&quot;friends&quot;</span><span class="p">:[</span><span class="s2">&quot;ken&quot;</span><span class="p">,</span><span class="s2">&quot;taro&quot;</span><span class="p">,</span><span class="s2">&quot;jiro&quot;</span><span class="p">,</span><span class="s2">&quot;moritapo&quot;</span><span class="p">,</span><span class="s2">&quot;tomo&quot;</span><span class="p">]}</span>
<span class="p">]</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], 6]</span>
</pre></div>
</div>
<p>Let’s show list of users who contains specified user in friend list.</p>
<p>Execution example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">User</span> <span class="o">--</span><span class="n">query</span> <span class="n">friends</span><span class="p">:</span><span class="nd">@tomo</span> <span class="o">--</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">username</span>
<span class="c1"># [</span>
<span class="c1">#   [</span>
<span class="c1">#     0,</span>
<span class="c1">#     1337566253.89858,</span>
<span class="c1">#     0.000355720520019531</span>
<span class="c1">#   ],</span>
<span class="c1">#   [</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         5</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_key&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;username&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;ken&quot;,</span>
<span class="c1">#         &quot;健作&quot;</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;taro&quot;,</span>
<span class="c1">#         &quot;ぐるんが太郎&quot;</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;jiro&quot;,</span>
<span class="c1">#         &quot;ぐるんが次郎&quot;</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;moritapo&quot;,</span>
<span class="c1">#         &quot;森田&quot;</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;hana&quot;,</span>
<span class="c1">#         &quot;花子&quot;</span>
<span class="c1">#       ]</span>
<span class="c1">#     ]</span>
<span class="c1">#   ]</span>
<span class="c1"># ]</span>
<span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">User</span> <span class="o">--</span><span class="n">query</span> <span class="n">friends</span><span class="p">:</span><span class="nd">@jiro</span> <span class="o">--</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">username</span>
<span class="c1"># [</span>
<span class="c1">#   [</span>
<span class="c1">#     0,</span>
<span class="c1">#     1337566253.89858,</span>
<span class="c1">#     0.000355720520019531</span>
<span class="c1">#   ],</span>
<span class="c1">#   [</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         3</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_key&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;username&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;ken&quot;,</span>
<span class="c1">#         &quot;健作&quot;</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;taro&quot;,</span>
<span class="c1">#         &quot;ぐるんが太郎&quot;</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;hana&quot;,</span>
<span class="c1">#         &quot;花子&quot;</span>
<span class="c1">#       ]</span>
<span class="c1">#     ]</span>
<span class="c1">#   ]</span>
<span class="c1"># ]</span>
</pre></div>
</div>
<p>Then drilldown the count which shows user is listed as friend.</p>
<p>Execution example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">User</span> <span class="o">--</span><span class="n">limit</span> <span class="mi">0</span> <span class="o">--</span><span class="n">drilldown</span> <span class="n">friends</span>
<span class="c1"># [</span>
<span class="c1">#   [</span>
<span class="c1">#     0,</span>
<span class="c1">#     1337566253.89858,</span>
<span class="c1">#     0.000355720520019531</span>
<span class="c1">#   ],</span>
<span class="c1">#   [</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         6</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_id&quot;,</span>
<span class="c1">#           &quot;UInt32&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_key&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;friends&quot;,</span>
<span class="c1">#           &quot;User&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;index_friends&quot;,</span>
<span class="c1">#           &quot;UInt32&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;username&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ]</span>
<span class="c1">#     ],</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         6</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_key&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_nsubrecs&quot;,</span>
<span class="c1">#           &quot;Int32&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;taro&quot;,</span>
<span class="c1">#         3</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;jiro&quot;,</span>
<span class="c1">#         3</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;tomo&quot;,</span>
<span class="c1">#         5</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;moritapo&quot;,</span>
<span class="c1">#         2</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;ken&quot;,</span>
<span class="c1">#         3</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;hana&quot;,</span>
<span class="c1">#         1</span>
<span class="c1">#       ]</span>
<span class="c1">#     ]</span>
<span class="c1">#   ]</span>
<span class="c1"># ]</span>
</pre></div>
</div>
<p>As you can see, it shows the results which follows reverse resolution of reference relationship.</p>
</div>
<div class="section" id="geo-location-search-with-index">
<h2><span class="section-number">4.6.3. </span>Geo location search with index<a class="headerlink" href="#geo-location-search-with-index" title="Permalink to this headline">¶</a></h2>
<p>Groonga supports to add indexes to the column which stores geo location information.
Groonga is very fast because it use such indexes against the column which contains geo location information to search enormous number of records.</p>
<p>Execution example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_create</span> <span class="o">--</span><span class="n">name</span> <span class="n">GeoSite</span> <span class="o">--</span><span class="n">flags</span> <span class="n">TABLE_HASH_KEY</span> <span class="o">--</span><span class="n">key_type</span> <span class="n">ShortText</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">GeoSite</span> <span class="o">--</span><span class="n">name</span> <span class="n">location</span> <span class="o">--</span><span class="nb">type</span> <span class="n">WGS84GeoPoint</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">table_create</span> <span class="o">--</span><span class="n">name</span> <span class="n">GeoIndex</span> <span class="o">--</span><span class="n">flags</span> <span class="n">TABLE_PAT_KEY</span> <span class="o">--</span><span class="n">key_type</span> <span class="n">WGS84GeoPoint</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">column_create</span> <span class="o">--</span><span class="n">table</span> <span class="n">GeoIndex</span> <span class="o">--</span><span class="n">name</span> <span class="n">index_point</span> <span class="o">--</span><span class="nb">type</span> <span class="n">GeoSite</span> <span class="o">--</span><span class="n">flags</span> <span class="n">COLUMN_INDEX</span> <span class="o">--</span><span class="n">source</span> <span class="n">location</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], true]</span>
<span class="n">load</span> <span class="o">--</span><span class="n">table</span> <span class="n">GeoSite</span>
<span class="p">[</span>
 <span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;http://example.org/&quot;</span><span class="p">,</span><span class="s2">&quot;location&quot;</span><span class="p">:</span><span class="s2">&quot;128452975x503157902&quot;</span><span class="p">},</span>
 <span class="p">{</span><span class="s2">&quot;_key&quot;</span><span class="p">:</span><span class="s2">&quot;http://example.net/&quot;</span><span class="p">,</span><span class="s2">&quot;location&quot;</span><span class="p">:</span><span class="s2">&quot;128487316x502920929&quot;</span><span class="p">}</span>
<span class="p">]</span>
<span class="c1"># [[0, 1337566253.89858, 0.000355720520019531], 2]</span>
<span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">GeoSite</span> <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;geo_in_circle(location, &quot;128515259x503187188&quot;, 5000)&#39;</span> <span class="o">--</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">location</span>
<span class="c1"># [</span>
<span class="c1">#   [</span>
<span class="c1">#     0,</span>
<span class="c1">#     1337566253.89858,</span>
<span class="c1">#     0.000355720520019531</span>
<span class="c1">#   ],</span>
<span class="c1">#   [</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         1</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_key&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;location&quot;,</span>
<span class="c1">#           &quot;WGS84GeoPoint&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;http://example.org/&quot;,</span>
<span class="c1">#         &quot;128452975x503157902&quot;</span>
<span class="c1">#       ]</span>
<span class="c1">#     ]</span>
<span class="c1">#   ]</span>
<span class="c1"># ]</span>
</pre></div>
</div>
<p>These indexes are also used when sorting the records with geo location search.</p>
<p>Execution example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">--</span><span class="n">table</span> <span class="n">GeoSite</span> <span class="o">--</span><span class="nb">filter</span> <span class="s1">&#39;geo_in_circle(location, &quot;128515259x503187188&quot;, 50000)&#39;</span> <span class="o">--</span><span class="n">output_columns</span> <span class="n">_key</span><span class="p">,</span><span class="n">location</span><span class="p">,</span><span class="n">_score</span> <span class="o">--</span><span class="n">sort_keys</span> <span class="s1">&#39;-geo_distance(location, &quot;128515259x503187188&quot;)&#39;</span> <span class="o">--</span><span class="n">scorer</span> <span class="s1">&#39;_score = geo_distance(location, &quot;128515259x503187188&quot;)&#39;</span>
<span class="c1"># [</span>
<span class="c1">#   [</span>
<span class="c1">#     0,</span>
<span class="c1">#     1337566253.89858,</span>
<span class="c1">#     0.000355720520019531</span>
<span class="c1">#   ],</span>
<span class="c1">#   [</span>
<span class="c1">#     [</span>
<span class="c1">#       [</span>
<span class="c1">#         2</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_key&quot;,</span>
<span class="c1">#           &quot;ShortText&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;location&quot;,</span>
<span class="c1">#           &quot;WGS84GeoPoint&quot;</span>
<span class="c1">#         ],</span>
<span class="c1">#         [</span>
<span class="c1">#           &quot;_score&quot;,</span>
<span class="c1">#           &quot;Int32&quot;</span>
<span class="c1">#         ]</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;http://example.org/&quot;,</span>
<span class="c1">#         &quot;128452975x503157902&quot;,</span>
<span class="c1">#         2054</span>
<span class="c1">#       ],</span>
<span class="c1">#       [</span>
<span class="c1">#         &quot;http://example.net/&quot;,</span>
<span class="c1">#         &quot;128487316x502920929&quot;,</span>
<span class="c1">#         6720</span>
<span class="c1">#       ]</span>
<span class="c1">#     ]</span>
<span class="c1">#   ]</span>
<span class="c1"># ]</span>
</pre></div>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">4.6. Tag search and reverse resolution of reference relationships</a><ul>
<li><a class="reference internal" href="#tag-search">4.6.1. Tag search</a></li>
<li><a class="reference internal" href="#reverse-resolution-of-reference-relationships">4.6.2. Reverse resolution of reference relationships</a></li>
<li><a class="reference internal" href="#geo-location-search-with-index">4.6.3. Geo location search with index</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="drilldown.html"
                        title="previous chapter"><span class="section-number">4.5. </span>Drilldown</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="match_columns.html"
                        title="next chapter"><span class="section-number">4.7. </span>match_columns parameter</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="match_columns.html" title="4.7. match_columns parameter"
             >next</a> |</li>
        <li class="right" >
          <a href="drilldown.html" title="4.5. Drilldown"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Groonga v11.0.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../tutorial.html" ><span class="section-number">4. </span>Tutorial</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">4.6. </span>Tag search and reverse resolution of reference relationships</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2009-2021, Brazil, Inc.
    </div>
      <script src="http://connect.facebook.net/en_US/all.js"></script>

    <script>
      FB.init({
         appId  : null,
         status : true, // check login status
         cookie : true, // enable cookies to allow the server to access the session
         xfbml  : true  // parse XFBML
      });
    </script>
  </body>

</html>