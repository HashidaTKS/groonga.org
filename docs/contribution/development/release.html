<!DOCTYPE html>

<html lang="en">
  <head>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-7532323-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-7532323-1');
    </script>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>12.3.7. リリース手順 &#8212; Groonga v11.0.9 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../static/groonga.css" />
    
    <script data-url_root="../../" id="documentation_options" src="../../static/documentation_options.js"></script>
    <script src="../../static/jquery.js"></script>
    <script src="../../static/underscore.js"></script>
    <script src="../../static/doctools.js"></script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="12.3.8. テスト方法" href="test.html" />
    <link rel="prev" title="12.3.5. クエリの実現" href="query.html" /> 
      <meta property="fb:page_id" content="201193596592346" /><!-- groonga -->
    <meta property="fb:admins" content="664204556" /><!-- kouhei.sutou -->
    <meta property="og:type" content="product" />
    <meta property="og:image" content="http://groonga.org/images/logos/groonga-icon-full-size.png" />
    <meta property="og:site_name" content="groonga" />

    <link rel="stylesheet" href="/css/sphinx.css" type="text/css" />
  </head>
  <body>
    <div id="fb-root"></div>

<div class="header">
  <h1 class="title">
    <a id="top-link" href="../../../">
      <span class="project">groonga</span>
      <span class="separator">-</span>
      <span class="description">An open-source fulltext search engine and column store.</span>
    </a>
  </h1>

      <div class="facebook-buttons">
      <fb:like href="http://www.facebook.com/pages/groonga/201193596592346"
               layout="standard"
               width="290"></fb:like>
    </div>
    <div class="other-language-links">

    <ul>
      <li><a href="../../../ja/docs/contribution/development/release.html">日本語</a></li>
    </ul>
  </div>
</div>
  

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="test.html" title="12.3.8. テスト方法"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="query.html" title="12.3.5. クエリの実現"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Groonga v11.0.9 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../contribution.html" ><span class="section-number">12. </span>How to contribute to groonga</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../development.html" accesskey="U"><span class="section-number">12.3. </span>For Groonga developers</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">12.3.7. </span>リリース手順</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="id1">
<h1><span class="section-number">12.3.7. </span>リリース手順<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id2">
<h2><span class="section-number">12.3.7.1. </span>前提条件<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>リリース手順の前提条件は以下の通りです。</p>
<ul class="simple">
<li><p>ビルド環境は Debian GNU/Linux (sid)</p></li>
<li><p>コマンドラインの実行例はzsh</p></li>
</ul>
<p>作業ディレクトリ例は以下を使用します。</p>
<ul class="simple">
<li><p>GROONGA_DIR=$HOME/work/groonga</p></li>
<li><p>GROONGA_CLONE_DIR=$HOME/work/groonga/groonga.clean</p></li>
<li><p>GROONGA_ORG_PATH=$HOME/work/groonga/groonga.org</p></li>
<li><p>CUTTER_DIR=$HOME/work/cutter</p></li>
<li><p>CUTTER_SOURCE_PATH=$HOME/work/cutter/cutter</p></li>
<li><p>APACHE_ARROW_REPOSITORY=$HOME/work/apache/arrow</p></li>
<li><p>PACKAGES_GROONGA_ORG_REPOSITORY=$HOME/work/groonga/packages.groonga.org</p></li>
</ul>
</div>
<div class="section" id="id3">
<h2><span class="section-number">12.3.7.2. </span>最初の1回だけ行う手順<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id4">
<h3><span class="section-number">12.3.7.2.1. </span>ビルド環境の準備<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>以下にGroongaのリリース作業を行うために事前にインストール
しておくべきパッケージを示します。</p>
<p>なお、ビルド環境としては Debian GNU/Linux (sid)を前提として説明しているため、その他の環境では適宜読み替えて下さい。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">V</span> <span class="n">debootstrap</span> <span class="n">createrepo</span> <span class="n">rpm</span> <span class="n">mercurial</span> <span class="n">python</span><span class="o">-</span><span class="n">docutils</span> <span class="n">python</span><span class="o">-</span><span class="n">jinja2</span> <span class="n">ruby</span><span class="o">-</span><span class="n">full</span> <span class="n">mingw</span><span class="o">-</span><span class="n">w64</span> <span class="n">g</span><span class="o">++-</span><span class="n">mingw</span><span class="o">-</span><span class="n">w64</span> <span class="n">mecab</span> <span class="n">libmecab</span><span class="o">-</span><span class="n">dev</span> <span class="n">nsis</span> <span class="n">gnupg2</span> <span class="n">dh</span><span class="o">-</span><span class="n">autoreconf</span> <span class="n">bison</span>
</pre></div>
</div>
<p>また、Sphinxは常に最新のバージョンを使う事を推奨します。 <code class="docutils literal notranslate"><span class="pre">pip3</span></code> を使用して最新のSphinxをインストールするようにして下さい。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">pip3</span> <span class="n">install</span> <span class="o">--</span><span class="n">upgrade</span> <span class="n">sphinx</span>
</pre></div>
</div>
<p>また、rubyのrakeパッケージを以下のコマンドによりインストールします。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">sudo</span> <span class="n">gem</span> <span class="n">install</span> <span class="n">rake</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h3><span class="section-number">12.3.7.2.2. </span>パッケージ署名用秘密鍵のインポート<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>リリース作業ではRPMパッケージに対する署名を行います。
その際、パッケージ署名用の鍵が必要です。</p>
<p>Groongaプロジェクトでは署名用の鍵をリリース担当者の公開鍵で暗号化してリポジトリのpackages/ディレクトリ以下へと登録しています。新しいリリース担当者に任命されたばかりで、まだ自分用に暗号化された鍵が無い場合には、他のリリース担当者に依頼して署名用の鍵を暗号化してもらって下さい。</p>
<p>リリース担当者はリポジトリに登録された秘密鍵を復号した後に鍵のインポートを以下のコマンドにて行います。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">cd</span> <span class="n">packages</span>
<span class="o">%</span> <span class="n">gpg</span> <span class="o">--</span><span class="n">decrypt</span> <span class="n">release</span><span class="o">-</span><span class="n">key</span><span class="o">-</span><span class="n">secret</span><span class="o">.</span><span class="n">asc</span><span class="o">.</span><span class="n">gpg</span><span class="o">.</span><span class="p">(</span><span class="n">担当者</span><span class="p">)</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">復号した鍵</span>
<span class="n">ファイル</span><span class="p">)</span>
<span class="o">%</span> <span class="n">gpg</span> <span class="o">--</span><span class="kn">import</span>  <span class="p">(</span><span class="n">復号した鍵ファイル</span><span class="p">)</span>
</pre></div>
</div>
<p>鍵のインポートが正常終了すると gpg –list-keys でGroongaの署名用の鍵を確認することができます。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pub</span>   <span class="mi">1024</span><span class="n">R</span><span class="o">/</span><span class="n">F10399C0</span> <span class="mi">2012</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">24</span>
<span class="n">uid</span>                  <span class="n">groonga</span> <span class="n">Key</span> <span class="p">(</span><span class="n">groonga</span> <span class="n">Official</span> <span class="n">Signing</span> <span class="n">Key</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">packages</span><span class="nd">@groonga</span><span class="o">.</span><span class="n">org</span><span class="o">&gt;</span>
<span class="n">sub</span>   <span class="mi">1024</span><span class="n">R</span><span class="o">/</span><span class="n">BC009774</span> <span class="mi">2012</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">24</span>
</pre></div>
</div>
<p>鍵をインポートしただけでは使用することができないため、インポートした鍵に対してtrust,signを行う必要があります。</p>
<p>以下のコマンドを実行して署名を行います。(途中の選択肢は省略):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">gpg</span> <span class="o">--</span><span class="n">edit</span><span class="o">-</span><span class="n">key</span> <span class="n">packages</span><span class="nd">@groonga</span><span class="o">.</span><span class="n">org</span>
<span class="n">gpg</span><span class="o">&gt;</span> <span class="n">trust</span>
<span class="n">gpg</span><span class="o">&gt;</span> <span class="n">sign</span>
<span class="n">gpg</span><span class="o">&gt;</span> <span class="n">save</span>
<span class="n">gpg</span><span class="o">&gt;</span> <span class="n">quit</span>
</pre></div>
</div>
<p>この作業は、新規にリリースを行うことになった担当者やパッケージに署名する鍵に変更があった場合などに行います。</p>
</div>
<div class="section" id="ppa">
<h3><span class="section-number">12.3.7.2.3. </span>PPA用の鍵の登録<a class="headerlink" href="#ppa" title="Permalink to this headline">¶</a></h3>
<p>この作業は、新規にリリースを行うことになった担当者のみ行います。</p>
<p>[Launchpad](<a class="reference external" href="https://launchpad.net/">https://launchpad.net/</a>)にアカウントを作成し、自分の普段使いの秘密鍵を登録した上で、他のリリース担当者に依頼して[Groongaチーム](<a class="reference external" href="https://launchpad.net/~groonga">https://launchpad.net/~groonga</a>)に追加してもらって下さい。</p>
</div>
<div class="section" id="id6">
<h3><span class="section-number">12.3.7.2.4. </span>リリース作業用ディレクトリの作成<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>Groongaのリリース作業ではリリース専用の環境下(コンパイルフラグ)でビルドする必要があります。</p>
<p>リリース時と開発時でディレクトリを分けずに作業することもできますが、誤ったコンパイルフラグでリリースしてしまう危険があります。</p>
<p>そのため、以降の説明では$GROONGA_DIR以下のディレクトリにリリース用の作業ディレクトリ(groonga.clean)としてソースコードをcloneしたものとして説明します。</p>
</div>
</div>
<div class="section" id="id7">
<h2><span class="section-number">12.3.7.3. </span>毎回のリリースで行う手順<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<div class="section" id="groonga">
<h3><span class="section-number">12.3.7.3.1. </span>Groongaのソースコード取得<a class="headerlink" href="#groonga" title="Permalink to this headline">¶</a></h3>
<p>リリース用のクリーンな状態でソースコードを取得するために$GROONGA_DIRにて以下のコマンドを実行します。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">git</span> <span class="n">clone</span> <span class="o">--</span><span class="n">recursive</span> <span class="n">git</span><span class="nd">@github</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">groonga</span><span class="o">/</span><span class="n">groonga</span><span class="o">.</span><span class="n">git</span> <span class="n">groonga</span><span class="o">.</span><span class="n">clean</span>
</pre></div>
</div>
<p>この作業はリリース作業ごとに行います。</p>
</div>
<div class="section" id="id8">
<h3><span class="section-number">12.3.7.3.2. </span>Groongaのウェブサイトの取得<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>GroongaのウェブサイトのソースはGroonga同様にGitHubにリポジトリを置いています。</p>
<p>リリース作業では後述するコマンド(make update-latest-release)にてトップページのバージョンを置き換えることができるようになっています。</p>
<p>Groongaのウェブサイトのソースコードを$GROONGA_ORG_PATHとして取得するためには、$GROONGA_DIRにて以下のコマンドを実行します。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">git</span> <span class="n">clone</span> <span class="n">git</span><span class="nd">@github</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">groonga</span><span class="o">/</span><span class="n">groonga</span><span class="o">.</span><span class="n">org</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<p>これで、$GROONGA_ORG_PATHにgroonga.orgのソースを取得できます。</p>
</div>
<div class="section" id="cutter">
<h3><span class="section-number">12.3.7.3.3. </span>cutterのソースコード取得<a class="headerlink" href="#cutter" title="Permalink to this headline">¶</a></h3>
<p>Groongaのリリース作業では、cutterに含まれるスクリプトを使用しています。</p>
<p>そこであらかじめ用意しておいた$HOME/work/cutterディレクトリにてcutterのソースコードを以下のコマンドにて取得します。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">git</span> <span class="n">clone</span> <span class="n">git</span><span class="nd">@github</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">clear</span><span class="o">-</span><span class="n">code</span><span class="o">/</span><span class="n">cutter</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<p>これで、$CUTTER_SOURCE_PATHディレクトリにcutterのソースを取得できます。</p>
</div>
<div class="section" id="configure">
<h3><span class="section-number">12.3.7.3.4. </span>configureスクリプトの生成<a class="headerlink" href="#configure" title="Permalink to this headline">¶</a></h3>
<p>Groongaのソースコードをcloneした時点ではconfigureスクリプトが含まれておらず、そのままmakeコマンドにてビルドすることができません。</p>
<p>$GROONGA_CLONE_DIRにてautogen.shを以下のように実行します。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">sh</span> <span class="n">autogen</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>このコマンドの実行により、configureスクリプトが生成されます。</p>
</div>
<div class="section" id="id9">
<h3><span class="section-number">12.3.7.3.5. </span>configureスクリプトの実行<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>Makefileを生成するためにconfigureスクリプトを実行します。</p>
<p>リリース用にビルドするためには以下のオプションを指定してconfigureを実行します。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>% ./configure \
      --prefix=/tmp/local \
      --with-launchpad-uploader-pgp-key=(Launchpadに登録したkeyID) \
      --with-groonga-org-path=$HOME/work/groonga/groonga.org \
      --enable-document \
      --with-ruby \
      --enable-mruby \
      --with-cutter-source-path=$HOME/work/cutter/cutter
</pre></div>
</div>
<p>configureオプションである–with-groonga-org-pathにはGroongaのウェブサイトのリポジトリをcloneした場所を指定します。</p>
<p>configureオプションである–with-cutter-source-pathにはcutterのソースをcloneした場所を指定します。</p>
<p>以下のようにGroongaのソースコードをcloneした先からの相対パスを指定することもできます。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="o">./</span><span class="n">configure</span> \
      <span class="o">--</span><span class="n">prefix</span><span class="o">=/</span><span class="n">tmp</span><span class="o">/</span><span class="n">local</span> \
      <span class="o">--</span><span class="k">with</span><span class="o">-</span><span class="n">launchpad</span><span class="o">-</span><span class="n">uploader</span><span class="o">-</span><span class="n">pgp</span><span class="o">-</span><span class="n">key</span><span class="o">=</span><span class="p">(</span><span class="n">Launchpadに登録したkeyID</span><span class="p">)</span> \
      <span class="o">--</span><span class="k">with</span><span class="o">-</span><span class="n">groonga</span><span class="o">-</span><span class="n">org</span><span class="o">-</span><span class="n">path</span><span class="o">=../</span><span class="n">groonga</span><span class="o">.</span><span class="n">org</span> \
      <span class="o">--</span><span class="n">enable</span><span class="o">-</span><span class="n">document</span> \
      <span class="o">--</span><span class="k">with</span><span class="o">-</span><span class="n">ruby</span> \
      <span class="o">--</span><span class="n">enable</span><span class="o">-</span><span class="n">mruby</span> \
      <span class="o">--</span><span class="k">with</span><span class="o">-</span><span class="n">cutter</span><span class="o">-</span><span class="n">source</span><span class="o">-</span><span class="n">path</span><span class="o">=../../</span><span class="n">cutter</span><span class="o">/</span><span class="n">cutter</span>
</pre></div>
</div>
<p>あらかじめpackagesユーザでpackages.groonga.orgにsshログインできることを確認しておいてください。</p>
<p>ログイン可能であるかの確認は以下のようにコマンドを実行して行います。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">ssh</span> <span class="n">packages</span><span class="nd">@packages</span><span class="o">.</span><span class="n">groonga</span><span class="o">.</span><span class="n">org</span>
</pre></div>
</div>
<p>デバッグ用や開発用のパッケージをテスト用に公開する時は、 <code class="docutils literal notranslate"><span class="pre">--with-launchpad-ppa=groonga-nightly</span></code> を指定して不安定版のリポジトリにアップロードするように指定します。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>% ./configure \
      --with-launchpad-ppa=groonga-nightly \
      --prefix=/tmp/local \
      --with-launchpad-uploader-pgp-key=(Launchpadに登録したkeyID) \
      --with-groonga-org-path=$HOME/work/groonga/groonga.org \
      --enable-document \
      --with-ruby \
      --enable-mruby \
      --with-cutter-source-path=$HOME/work/cutter/cutter
</pre></div>
</div>
<p>新任のリリース担当者は必ず、この方法でPPAのリポジトリにパッケージをアップロードできる事を確認しておいてください。</p>
<p>PPAのリポジトリは、同名のパッケージを上書いてアップロードできないので、不安定版のリポジトリでビルドできることを確認してから、安定版のリポジトリへアップロードするようにしてください。</p>
</div>
<div class="section" id="id10">
<h3><span class="section-number">12.3.7.3.6. </span>変更点のまとめ<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>前回リリース時からの変更点を$GROONGA_CLONE_DIR/doc/source/news.rst（英語）にまとめます。
ここでまとめた内容についてはリリースアナウンスにも使用します。</p>
<p>前回リリースからの変更履歴を参照するには以下のコマンドを実行します。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>% git log -p --reverse $(git tag | tail -1)..
</pre></div>
</div>
<p>ログを^commitで検索しながら、以下の基準を目安として変更点を追記していきます。</p>
<p>含めるもの</p>
<ul class="simple">
<li><p>ユーザへ影響するような変更</p></li>
<li><p>互換性がなくなるような変更</p></li>
</ul>
<p>含めないもの</p>
<ul class="simple">
<li><p>内部的な変更(変数名の変更やらリファクタリング)</p></li>
</ul>
</div>
<div class="section" id="make-update-latest-release">
<h3><span class="section-number">12.3.7.3.7. </span>make update-latest-releaseの実行<a class="headerlink" href="#make-update-latest-release" title="Permalink to this headline">¶</a></h3>
<p>make update-latest-releaseコマンドでは、OLD_RELEASE_DATEに前回のリリースの日付を、NEW_RELEASE_DATEに次回リリースの日付（未来の日付）を指定します。</p>
<p>2.0.2のリリースを行った際は以下のコマンドを実行しました。::</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">make</span> <span class="n">update</span><span class="o">-</span><span class="n">latest</span><span class="o">-</span><span class="n">release</span> <span class="n">OLD_RELEASE</span><span class="o">=</span><span class="mf">2.0</span><span class="o">.</span><span class="mi">1</span> <span class="n">OLD_RELEASE_DATE</span><span class="o">=</span><span class="mi">2012</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">29</span> <span class="n">NEW_RELEASE_DATE</span><span class="o">=</span><span class="mi">2012</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">29</span>
</pre></div>
</div>
<p>これにより、clone済みのGroongaのWebサイトのトップページのソース(index.html,ja/index.html)やRPMパッケージのspecファイルのバージョン表記などが更新されます。</p>
</div>
<div class="section" id="make-update-examples">
<h3><span class="section-number">12.3.7.3.8. </span>make update-examplesの実行<a class="headerlink" href="#make-update-examples" title="Permalink to this headline">¶</a></h3>
<p>ドキュメントに埋め込まれている実行結果を更新するために、以下のコマンドを実行します。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">cd</span> <span class="n">doc</span> <span class="o">&amp;&amp;</span> <span class="n">make</span> <span class="n">update</span><span class="o">-</span><span class="n">examples</span>
</pre></div>
</div>
<p>doc/source/examples以下が更新されるので、それらをコミットします。</p>
</div>
<div class="section" id="make-update-files">
<h3><span class="section-number">12.3.7.3.9. </span>make update-filesの実行<a class="headerlink" href="#make-update-files" title="Permalink to this headline">¶</a></h3>
<p>ロケールメッセージの更新や変更されたファイルのリスト等を更新するために以下のコマンドを実行します。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">make</span> <span class="n">update</span><span class="o">-</span><span class="n">files</span>
</pre></div>
</div>
<p>make update-filesを実行すると新規に追加されたファイルなどが各種.amファイルへとリストアップされます。</p>
<p>リリースに必要なファイルですので漏れなくコミットします。</p>
</div>
<div class="section" id="make-update-po">
<h3><span class="section-number">12.3.7.3.10. </span>make update-poの実行<a class="headerlink" href="#make-update-po" title="Permalink to this headline">¶</a></h3>
<p>ドキュメントの最新版と各国語版の内容を同期するために、poファイルの更新を以下のコマンドにて実行します。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">make</span> <span class="n">update</span><span class="o">-</span><span class="n">po</span>
</pre></div>
</div>
<p>make update-poを実行すると、doc/locale/ja/LC_MESSAGES以下の各種.poファイルが更新されます。</p>
</div>
<div class="section" id="po">
<h3><span class="section-number">12.3.7.3.11. </span>poファイルの翻訳<a class="headerlink" href="#po" title="Permalink to this headline">¶</a></h3>
<p>make update-poコマンドの実行により更新した各種.poファイルを翻訳します。</p>
<p>翻訳結果をHTMLで確認するために、以下のコマンドを実行します。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">make</span> <span class="o">-</span><span class="n">C</span> <span class="n">doc</span><span class="o">/</span><span class="n">locale</span><span class="o">/</span><span class="n">ja</span> <span class="n">html</span>
<span class="o">%</span> <span class="n">make</span> <span class="o">-</span><span class="n">C</span> <span class="n">doc</span><span class="o">/</span><span class="n">locale</span><span class="o">/</span><span class="n">en</span> <span class="n">html</span>
</pre></div>
</div>
<p>修正が必要な箇所を調べて、 <code class="docutils literal notranslate"><span class="pre">***.edit</span></code> というファイルを適宜修正します。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">cd</span> <span class="n">groonga</span><span class="o">/</span><span class="n">doc</span><span class="o">/</span><span class="n">locale</span>
<span class="o">%</span> <span class="n">git</span> <span class="n">diff</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">***.edit</span></code> というファイルの編集中は、翻訳元のファイルは絶対に編集しないで下さい（編集すると、<code class="docutils literal notranslate"><span class="pre">***.edit</span></code> に加えた変更が make update-po の実行時に失われます）。
ファイルを編集したら、再度poファイルとHTMLを更新するために以下のコマンドを実行します。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">make</span> <span class="n">update</span><span class="o">-</span><span class="n">po</span>
<span class="o">%</span> <span class="n">make</span> <span class="o">-</span><span class="n">C</span> <span class="n">doc</span><span class="o">/</span><span class="n">locale</span><span class="o">/</span><span class="n">ja</span> <span class="n">html</span>
<span class="o">%</span> <span class="n">make</span> <span class="o">-</span><span class="n">C</span> <span class="n">doc</span><span class="o">/</span><span class="n">locale</span><span class="o">/</span><span class="n">en</span> <span class="n">html</span>
</pre></div>
</div>
<p>確認が完了したら、翻訳済みpoファイルをコミットします。</p>
</div>
<div class="section" id="id11">
<h3><span class="section-number">12.3.7.3.12. </span>各種テストの確認<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>リリース用のタグを設定する前に、以下のテストが全てパスしているかを確認します。
タグを設定してから問題が発覚すると、再度リリースすることになってしまうので、タグを設定する前に問題がないか確認します。</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/groonga/groonga/actions?query=workflow%3APackage">GitHub Actions</a></p></li>
<li><p><a class="reference external" href="https://travis-ci.org/github/groonga/groonga">TravisCI</a></p></li>
<li><p><a class="reference external" href="https://ci.appveyor.com/project/groonga/groonga">AppVeyor</a></p></li>
</ul>
<p>テストやパッケージの作成に失敗していたら、原因を特定して修正します。</p>
</div>
<div class="section" id="id12">
<h3><span class="section-number">12.3.7.3.13. </span>リリースタグの設定<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>リリース用のタグを打つには以下のコマンドを実行します。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">make</span> <span class="n">tag</span>
<span class="o">%</span> <span class="n">git</span> <span class="n">push</span> <span class="o">--</span><span class="n">tags</span> <span class="n">origin</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>タグを打った後にconfigureを実行することで、ドキュメント生成時のバージョン番号に反映されます。</p>
</div>
</div>
<div class="section" id="id13">
<h3><span class="section-number">12.3.7.3.14. </span>リリース用アーカイブファイルの作成<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<p>リリース用のソースアーカイブファイルを作成するために以下のコマンドを$GROONGA_CLONE_DIRにて実行します。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">make</span> <span class="n">dist</span>
</pre></div>
</div>
<p>これにより$GROONGA_CLONE_DIR/groonga-(バージョン).tar.gzが作成されます。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>タグを打つ前にmake distを行うとversionが古いままになることがあります。
するとgroonga –versionで表示されるバージョン表記が更新されないので注意が必要です。
make distで生成したtar.gzのversionおよびversion.shがタグと一致することを確認するのが望ましいです。</p>
</div>
</div>
<div class="section" id="id14">
<h3><span class="section-number">12.3.7.3.15. </span>リリース用アーカイブファイルのアップロード<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<p>Groongaのリリース用アーカイブファイルは、MroongaやPGroonga、Rroonga等関連プロダクトのリリースにも使用します。
生成でき次第アップロードしておくと、関連プロダクトのリリース作業がしやすくなります。</p>
<p>リリース用のアーカイブファイルは以下の手順でアップロードします。</p>
<p>アップロードはrsyncコマンドで行います。
以下のコマンドを実行して、現在のリポジトリーと同期します。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">cd</span> <span class="n">packages</span><span class="o">/</span><span class="n">source</span>
<span class="o">%</span> <span class="n">make</span> <span class="n">download</span>
</pre></div>
</div>
<p>これにより過去にリリースしたソースアーカイブ(.tar.gz)が
packages/source/filesディレクトリ以下へとダウンロードされます。</p>
<p>その後、以下のコマンドを実行してリリース用ソースアーカイブをアップロードします。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">cd</span> <span class="n">packages</span><span class="o">/</span><span class="n">source</span>
<span class="o">%</span> <span class="n">make</span> <span class="n">upload</span>
</pre></div>
</div>
<p>アップロードが正常終了すると、リリース用ソースアーカイブがpackages.groonga.orgへと反映されます。</p>
</div>
<div class="section" id="id15">
<h3><span class="section-number">12.3.7.3.16. </span>パッケージのビルド<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h3>
<p>リリース用のアーカイブファイルができたので、パッケージ化する作業を行います。</p>
<p>パッケージ化作業は以下の3種類を対象に行います。</p>
<ul class="simple">
<li><p>Debian系(.deb)</p></li>
<li><p>Red Hat系(.rpm)</p></li>
<li><p>Windows系(.exe,.zip)</p></li>
</ul>
<p>パッケージのビルドではいくつかのサブタスクから構成されています。</p>
</div>
<div class="section" id="debian">
<h3><span class="section-number">12.3.7.3.17. </span>Debian系パッケージのビルドとアップロード<a class="headerlink" href="#debian" title="Permalink to this headline">¶</a></h3>
<p>環境変数 <code class="docutils literal notranslate"><span class="pre">APACHE_ARROW_REPOSITORY</span></code> にapache/arrowのリポジトリをcloneしたパスを指定します。</p>
<p>現在サポートしているOSのバージョンは以下の通りです。</p>
<ul class="simple">
<li><p>Debian GNU/Linux</p>
<ul>
<li><p>stretch i386/amd64</p></li>
<li><p>buster i386/amd64</p></li>
</ul>
</li>
</ul>
<p>正常にビルドが終了すると$GROONGA_CLONE_DIR/packages/apt/repositories配下に.debパッケージが生成されます。</p>
<p>debパッケージをビルドするには以下のコマンドを実行します。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">cd</span> <span class="n">packages</span>
<span class="o">%</span> <span class="n">rake</span> <span class="n">apt</span>
</pre></div>
</div>
<p>パッケージのビルドが完了したら、以下のコマンドを実行してビルドしたパッケージをpackages.groonga.orgへアップロードします。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">rake</span> <span class="n">apt</span><span class="p">:</span><span class="n">release</span>
</pre></div>
</div>
<p>この段階では、ビルドしたパッケージはまだ未署名なので、$PACKAGES_GROONGA_ORG_REPOSITORYに移動し、以下のコマンドを実行します。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">rake</span> <span class="n">apt</span>
</pre></div>
</div>
<p>上記のコマンドを実行することで、リポジトリーの同期、パッケージの署名、リポジトリーの更新、アップロードまで実行できます。</p>
</div>
<div class="section" id="ubuntu">
<h3><span class="section-number">12.3.7.3.18. </span>Ubuntu用パッケージのアップロード<a class="headerlink" href="#ubuntu" title="Permalink to this headline">¶</a></h3>
<p>Ubuntu向けパッケージの作成には、作業マシン上にGroongaのビルドに必要な依存ソフトウェア一式がインストールされている必要があります。以下のようにしてインストールしておいて下さい。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">sudo</span> <span class="n">apt</span> <span class="n">build</span><span class="o">-</span><span class="n">dep</span> <span class="n">groonga</span>
</pre></div>
</div>
<p>Ubuntu向けのパッケージのアップロードには以下のコマンドを実行します。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">cd</span> <span class="n">packages</span>
<span class="o">%</span> <span class="n">rake</span> <span class="n">ubuntu</span>
</pre></div>
</div>
<p>現在サポートされているのは以下の通りです。</p>
<ul class="simple">
<li><p>Xenial i386/amd64</p></li>
<li><p>Bionic i386/amd64</p></li>
<li><p>Disco  i386/amd64</p></li>
<li><p>Focal  amd64</p></li>
</ul>
<p>アップロードが正常終了すると、launchpad.net上でビルドが実行され、ビルド結果がメールで通知されます。ビルドに成功すると、リリース対象のパッケージがlaunchpad.netのGroongaチームのPPAへと反映されます。公開されているパッケージは以下のURLで確認できます。</p>
<blockquote>
<div><p><a class="reference external" href="https://launchpad.net/~groonga/+archive/ubuntu/ppa">https://launchpad.net/~groonga/+archive/ubuntu/ppa</a></p>
</div></blockquote>
<div class="section" id="id16">
<h4><span class="section-number">12.3.7.3.18.1. </span>Ubuntu用パッケージの公開の取り消し<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h4>
<p>LaunchpadのGroongaチームのページで対象のPPAを選択し、バージョン一覧の上にある「View package details」リンクの先で「Delete packages」リンクを辿ると、アップロード済みパッケージを削除できます。
例；[不安定版リポジトリのパッケージの削除用のページ](<a class="reference external" href="https://launchpad.net/~groonga/+archive/ubuntu/nightly/+delete-packages">https://launchpad.net/~groonga/+archive/ubuntu/nightly/+delete-packages</a>)。</p>
</div>
</div>
<div class="section" id="red-hat">
<h3><span class="section-number">12.3.7.3.19. </span>Red Hat系パッケージのビルドとアップロード<a class="headerlink" href="#red-hat" title="Permalink to this headline">¶</a></h3>
<p>現在サポートしているOSのバージョンは以下の通りです。</p>
<ul class="simple">
<li><p>centos-6 x86_64</p></li>
<li><p>centos-7 x86_64</p></li>
<li><p>centos-8 x86_64</p></li>
</ul>
<p>ビルドが正常終了すると$GROONGA_CLONE_DIR/packages/yum/repositories配下にRPMパッケージが生成されます。</p>
<ul class="simple">
<li><p>repositories/yum/centos/6/x86_64/Packages</p></li>
<li><p>repositories/yum/centos/7/x86_64/Packages</p></li>
<li><p>repositories/yum/centos/8/x86_64/Packages</p></li>
</ul>
<p>rpmパッケージをビルドするには以下のコマンドを実行します。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">cd</span> <span class="n">packages</span>
<span class="o">%</span> <span class="n">rake</span> <span class="n">yum</span>
</pre></div>
</div>
<p>パッケージのビルドが完了したら、以下のコマンドを実行してビルドしたパッケージをpackages.groonga.orgへアップロードします。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">rake</span> <span class="n">yum</span><span class="p">:</span><span class="n">release</span>
</pre></div>
</div>
<p>この段階では、ビルドしたパッケージはまだ未署名なので、$PACKAGES_GROONGA_ORG_REPOSITORYに移動し、以下のコマンドを実行します。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">rake</span> <span class="n">yum</span>
</pre></div>
</div>
<p>上記のコマンドを実行することで、リポジトリーの同期、パッケージの署名、リポジトリーの更新、アップロードまで実行できます。</p>
</div>
<div class="section" id="windows">
<h3><span class="section-number">12.3.7.3.20. </span>Windows用パッケージのビルドとアップロード<a class="headerlink" href="#windows" title="Permalink to this headline">¶</a></h3>
<p>Windowsパッケージのビルドに必要なファイルを以下のコマンドを実行してダウンロードします。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">cd</span> <span class="n">packages</span><span class="o">/</span><span class="n">windows</span>
<span class="o">%</span> <span class="n">make</span> <span class="n">download</span>
</pre></div>
</div>
<p>これにより、Groongaのインストーラやzipアーカイブが packages/windows以下へとダウンロードされます。</p>
<p>次に、以下のコマンドを実行してWindowsパッケージをビルドします。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">cd</span> <span class="n">packages</span><span class="o">/</span><span class="n">windows</span>
<span class="o">%</span> <span class="n">make</span> <span class="n">build</span>
<span class="o">%</span> <span class="n">make</span> <span class="n">package</span>
<span class="o">%</span> <span class="n">make</span> <span class="n">installer</span>
</pre></div>
</div>
<p>make buildでクロスコンパイルを行います。
正常に終了するとdist-x64/dist-x86ディレクトリ以下にx64/x86バイナリを作成します。</p>
<p>make packageが正常に終了するとzipアーカイブをfilesディレクトリ以下に作成します。</p>
<p>make installerが正常に終了するとWindowsインストーラをfilesディレクトリ以下に作成します。</p>
<p>パッケージのビルドが完了したら、以下のコマンドを実行してビルドしたパッケージをpackages.groonga.orgへアップロードします。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">cd</span> <span class="n">packages</span><span class="o">/</span><span class="n">windows</span>
<span class="o">%</span> <span class="n">make</span> <span class="n">upload</span>
</pre></div>
</div>
</div>
<div class="section" id="id17">
<h3><span class="section-number">12.3.7.3.21. </span>パッケージの動作確認<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>パッケージの動作確認はGitHub Actions上で自動で実施できるように改良中で、以下の手順は今後削除する予定です。</p>
</div>
<p>ビルドしたパッケージに対しリリース前の動作確認を行います。</p>
<p>Debian系もしくはRed Hat系の場合には本番環境へとアップロードする前にローカルのaptないしyumのリポジトリを参照して正常に更新できることを確認します。</p>
<p>ここでは以下のようにrubyを利用してリポジトリをwebサーバ経由で参照できるようにします。</p>
<p>yumの場合:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">ruby</span> <span class="o">-</span><span class="n">run</span> <span class="o">-</span><span class="n">e</span> <span class="n">httpd</span> <span class="o">--</span> <span class="n">packages</span><span class="o">/</span><span class="n">yum</span><span class="o">/</span><span class="n">repositories</span>
<span class="o">%</span> <span class="n">yum</span> <span class="n">update</span>
<span class="o">...</span>
</pre></div>
</div>
<p>aptの場合:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">ruby</span> <span class="o">-</span><span class="n">run</span> <span class="o">-</span><span class="n">e</span> <span class="n">httpd</span> <span class="o">--</span> <span class="n">packages</span><span class="o">/</span><span class="n">apt</span><span class="o">/</span><span class="n">repositories</span>
<span class="o">%</span> <span class="n">sudo</span> <span class="n">apt</span> <span class="n">update</span>
<span class="o">...</span>
</pre></div>
</div>
<div class="section" id="grntest">
<h4><span class="section-number">12.3.7.3.21.1. </span>grntestの準備<a class="headerlink" href="#grntest" title="Permalink to this headline">¶</a></h4>
<p>TravisCIの結果が正常であれば、この手順はスキップして構いません。
grntestを実行するためにはGroongaのテストデータとgrntestのソースが必要です。</p>
<p>まずGroongaのソースを任意のディレクトリへと展開します。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">tar</span> <span class="n">zxvf</span> <span class="n">groonga</span><span class="o">-</span><span class="p">(</span><span class="n">バージョン</span><span class="p">)</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
</pre></div>
</div>
<p>次にGroongaのtest/functionディレクトリ以下にgrntestのソースを展開します。
つまりtest/function/grntestという名前でgrntestのソースを配置します。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">ls</span> <span class="n">test</span><span class="o">/</span><span class="n">function</span><span class="o">/</span><span class="n">grntest</span><span class="o">/</span>
<span class="n">README</span><span class="o">.</span><span class="n">md</span>  <span class="n">binlib</span>  <span class="n">license</span>  <span class="n">test</span>
</pre></div>
</div>
</div>
<div class="section" id="id18">
<h4><span class="section-number">12.3.7.3.21.2. </span>grntestの実行方法<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h4>
<p>grntestではGroongaコマンドを明示的に指定することができます。
後述のパッケージごとのgrntestによる動作確認では以下のようにして実行します。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">GROONGA</span><span class="o">=</span><span class="p">(</span><span class="n">groongaのパス指定</span><span class="p">)</span> <span class="n">test</span><span class="o">/</span><span class="n">function</span><span class="o">/</span><span class="n">run</span><span class="o">-</span><span class="n">test</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>最後にgrntestによる実行結果が以下のようにまとめて表示されます。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">55</span> <span class="n">tests</span><span class="p">,</span> <span class="mi">52</span> <span class="n">passes</span><span class="p">,</span> <span class="mi">0</span> <span class="n">failures</span><span class="p">,</span> <span class="mi">3</span> <span class="ow">not</span> <span class="n">checked</span> <span class="n">tests</span><span class="o">.</span>
<span class="mf">94.55</span><span class="o">%</span> <span class="n">passed</span><span class="o">.</span>
</pre></div>
</div>
<p>grntestでエラーが発生しないことを確認します。</p>
</div>
<div class="section" id="id19">
<h4><span class="section-number">12.3.7.3.21.3. </span>Debian系の場合<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h4>
<p>Debian系の場合の動作確認手順は以下の通りとなります。</p>
<ul class="simple">
<li><p>旧バージョンをテスト環境へとインストールする</p></li>
<li><p>テスト環境の/etc/hostsを書き換えてpackages.groonga.orgがホストを
参照するように変更する</p></li>
<li><p>ホストでwebサーバを起動してドキュメントルートをビルド環境のもの
(repositories/apt/packages)に設定する</p></li>
<li><p>アップグレード手順を実行する</p></li>
<li><p>grntestのアーカイブを展開してインストールしたバージョンでテストを実
行する</p></li>
<li><p>grntestの正常終了を確認する</p></li>
</ul>
</div>
<div class="section" id="id20">
<h4><span class="section-number">12.3.7.3.21.4. </span>Red Hat系の場合<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h4>
<p>Red Hat系の場合の動作確認手順は以下の通りとなります。</p>
<ul class="simple">
<li><p>旧バージョンをテスト環境へとインストール</p></li>
<li><p>テスト環境の/etc/hostsを書き換えてpackages.groonga.orgがホストを参照するように変更する</p></li>
<li><p>ホストでwebサーバを起動してドキュメントルートをビルド環境のもの(packages/yum/repositories)に設定する</p></li>
<li><p>アップグレード手順を実行する</p></li>
<li><p>grntestのアーカイブを展開してインストールしたバージョンでテストを実行する</p></li>
<li><p>grntestの正常終了を確認する</p></li>
</ul>
</div>
<div class="section" id="id21">
<h4><span class="section-number">12.3.7.3.21.5. </span>Windows向けの場合<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>テスト環境で新規インストール/上書きインストールを行う</p></li>
<li><p>grntestのアーカイブを展開してインストールしたバージョンでテストを実行する</p></li>
<li><p>grntestの正常終了を確認する</p></li>
</ul>
<p>zipアーカイブも同様にしてgrntestを実行し動作確認を行います。</p>
</div>
</div>
<div class="section" id="id22">
<h3><span class="section-number">12.3.7.3.22. </span>リリースアナウンスの作成<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h3>
<p>リリースの際にはリリースアナウンスを流して、Groongaを広く通知します。</p>
<p>news.rstに変更点をまとめましたが、それを元にリリースアナウンスを作成します。</p>
<p>リリースアナウンスには以下を含めます。</p>
<ul class="simple">
<li><p>インストール方法へのリンク</p></li>
<li><p>リリースのトピック紹介</p></li>
<li><p>リリース変更点へのリンク</p></li>
<li><p>リリース変更点(news.rstの内容)</p></li>
</ul>
<p>リリースのトピック紹介では、これからGroongaを使う人へアピールする点や既存のバージョンを利用している人がアップグレードする際に必要な情報を提供します。</p>
<p>非互換な変更が含まれるのであれば、回避方法等の案内を載せることも重要です。</p>
<p>参考までに過去のリリースアナウンスへのリンクを以下に示します。</p>
<ul>
<li><p>[Groonga-talk] [ANN] Groonga 2.0.2</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="http://sourceforge.net/mailarchive/message.php?msg_id=29195195">http://sourceforge.net/mailarchive/message.php?msg_id=29195195</a></p></li>
</ul>
</div></blockquote>
</li>
<li><p>[groonga-dev,00794] [ANN] Groonga 2.0.2</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="http://osdn.jp/projects/groonga/lists/archive/dev/2012-April/000794.html">http://osdn.jp/projects/groonga/lists/archive/dev/2012-April/000794.html</a></p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p>後述しますが、Twitter等でのリリースアナウンスの際はここで用意したアナウンス文の要約を使用します。</p>
</div>
<div class="section" id="blogroonga">
<h3><span class="section-number">12.3.7.3.23. </span>blogroonga(ブログ)の更新<a class="headerlink" href="#blogroonga" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://groonga.org/blog/">http://groonga.org/blog/</a> および <a class="reference external" href="http://groonga.org/blog/">http://groonga.org/blog/</a> にて公開されているリリース案内を作成します。</p>
<p>基本的にはリリースアナウンスの内容をそのまま記載します。</p>
<p>cloneしたWebサイトのソースに対して以下のファイルを新規追加します。</p>
<ul class="simple">
<li><p>groonga.org/en/_post/(リリース日)-release.md</p></li>
<li><p>groonga.org/ja/_post/(リリース日)-release.md</p></li>
</ul>
<p>編集した内容をpushする前に確認したい場合にはJekyllおよびRedCloth（Textileパーサー）、RDiscount（Markdownパーサー）、JavaScript interpreter（therubyracer、Node.jsなど）が必要です。
インストールするには以下のコマンドを実行します。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">sudo</span> <span class="n">gem</span> <span class="n">install</span> <span class="n">jekyll</span> <span class="n">jekyll</span><span class="o">-</span><span class="n">paginate</span> <span class="n">RedCloth</span> <span class="n">rdiscount</span> <span class="n">therubyracer</span>
</pre></div>
</div>
<p>jekyllのインストールを行ったら、以下のコマンドでローカルにwebサーバを起動します。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">jekyll</span> <span class="n">serve</span> <span class="o">--</span><span class="n">watch</span>
</pre></div>
</div>
<p>あとはブラウザにてhttp://localhost:4000にアクセスして内容に問題がないかを確認します。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>記事を非公開の状態でアップロードするには.mdファイルのpublished:をfalseに設定します。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="n">layout</span><span class="p">:</span> <span class="n">post</span><span class="o">.</span><span class="n">en</span>
<span class="n">title</span><span class="p">:</span> <span class="n">Groonga</span> <span class="mf">2.0</span><span class="o">.</span><span class="mi">5</span> <span class="n">has</span> <span class="n">been</span> <span class="n">released</span>
<span class="n">published</span><span class="p">:</span> <span class="n">false</span>
<span class="o">---</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id23">
<h3><span class="section-number">12.3.7.3.24. </span>ドキュメントのアップロード<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h3>
<p>doc/source以下のドキュメントを更新、翻訳まで完了している状態で、ドキュメントのアップロード作業を行います。</p>
<p>そのためにはまず <code class="docutils literal notranslate"><span class="pre">groonga</span></code> のリポジトリをカレントディレクトリにして以下のコマンドを実行します。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>% GROONGA_VERSION=$(git tag --list | tail -n 1 | tr -d v)
% make update-document DOCUMENT_VERSION=$GROONGA_VERSION DOCUMENT_VERSION_FULL=$GROONGA_VERSION
</pre></div>
</div>
<p>ここでは最新のtagに基づいてリリースバージョンを調べ、明示的にそのバージョンを指定してドキュメントを更新するようにしています。
これによりcloneしておいたgroonga.orgのdoc/locale以下に更新したドキュメントがコピーされます。</p>
<p>生成されているドキュメントに問題のないことを確認できたら、コミット、pushしてgroonga.orgへと反映します。</p>
<p>また、<code class="docutils literal notranslate"><span class="pre">groonga.org</span></code> リポジトリの <code class="docutils literal notranslate"><span class="pre">_config.yml</span></code> に最新リリースのバージョン番号と日付を表す情報の指定があるので、これらも更新します。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">groonga_version</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">x</span>
<span class="n">groonga_release_date</span><span class="p">:</span> <span class="n">xxxx</span><span class="o">-</span><span class="n">xx</span><span class="o">-</span><span class="n">xx</span>
</pre></div>
</div>
</div>
<div class="section" id="homebrew">
<h3><span class="section-number">12.3.7.3.25. </span>Homebrewの更新<a class="headerlink" href="#homebrew" title="Permalink to this headline">¶</a></h3>
<p>この手順は省略可能です（Homebrewの更新はGroongaプロジェクト本体のリリース要件には含まれません）。</p>
<p>OS Xでのパッケージ管理方法として <a class="reference external" href="http://brew.sh/">Homebrew</a> があります。</p>
<p>Groongaを簡単にインストールできるようにするために、Homebrewへpull requestを送ります。</p>
<blockquote>
<div><p><a class="reference external" href="https://github.com/Homebrew/homebrew-core">https://github.com/Homebrew/homebrew-core</a></p>
</div></blockquote>
<p>すでにGroongaのFormulaは取り込まれているので、リリースのたびにFormulaの内容を更新する作業を実施します。</p>
<p>Groonga 3.0.6のときは以下のように更新してpull requestを送りました。</p>
<blockquote>
<div><p><a class="reference external" href="https://github.com/mxcl/homebrew/pull/21456/files">https://github.com/mxcl/homebrew/pull/21456/files</a></p>
</div></blockquote>
<p>上記URLを参照するとわかるようにソースアーカイブのurlとsha1チェックサムを更新します。</p>
</div>
<div class="section" id="id25">
<h3><span class="section-number">12.3.7.3.26. </span>リリースアナウンス<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h3>
<p>作成したリリースアナウンスをメーリングリストへと流します。</p>
<ul class="simple">
<li><p>groonga-dev <a class="reference external" href="mailto:groonga-dev&#37;&#52;&#48;lists&#46;osdn&#46;me">groonga-dev<span>&#64;</span>lists<span>&#46;</span>osdn<span>&#46;</span>me</a></p></li>
<li><p>Groonga-talk <a class="reference external" href="mailto:groonga-talk&#37;&#52;&#48;lists&#46;sourceforge&#46;net">groonga-talk<span>&#64;</span>lists<span>&#46;</span>sourceforge<span>&#46;</span>net</a></p></li>
</ul>
</div>
<div class="section" id="twitter">
<h3><span class="section-number">12.3.7.3.27. </span>Twitterでリリースアナウンスをする<a class="headerlink" href="#twitter" title="Permalink to this headline">¶</a></h3>
<p>blogroongaのリリースエントリには「リンクをあなたのフォロワーに共有する」ためのツイートボタンがあるので、そのボタンを使ってリリースアナウンスします。(画面下部に配置されている)</p>
<p>このボタンを経由する場合、ツイート内容に自動的にリリースタイトル(「groonga 2.0.8リリース」など)とblogroongaのリリースエントリのURLが挿入されます。</p>
<p>この作業はblogroongaの英語版、日本語版それぞれで行います。
あらかじめgroongaアカウントでログインしておくとアナウンスを円滑に行うことができます。</p>
</div>
<div class="section" id="facebook">
<h3><span class="section-number">12.3.7.3.28. </span>Facebookでリリースアナウンスをする<a class="headerlink" href="#facebook" title="Permalink to this headline">¶</a></h3>
<p>FacebookにGroongaグループがあります。
<a class="reference external" href="https://www.facebook.com/groonga/">https://www.facebook.com/groonga/</a></p>
<p>Groongaグループのメンバーになると、個人のアカウントではなく、Groongaグループのメンバーとして投稿できます。
ブログエントリなどをもとに、リリースアナウンスを投稿します。</p>
<p>以上でリリース作業は終了です。</p>
</div>
<div class="section" id="id26">
<h3><span class="section-number">12.3.7.3.29. </span>リリース後にやること<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h3>
<p>リリースアナウンスを流し終えたら、次期バージョンの開発が始まります。</p>
<ul class="simple">
<li><p>Groonga のbase_versionの更新</p></li>
</ul>
<div class="section" id="id27">
<h4><span class="section-number">12.3.7.3.29.1. </span>Groonga バージョン更新<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h4>
<p>$GROONGA_CLONE_DIRにて以下のコマンドを実行します。:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">make</span> <span class="n">update</span><span class="o">-</span><span class="n">version</span> <span class="n">NEW_VERSION</span><span class="o">=</span><span class="mf">2.0</span><span class="o">.</span><span class="mi">6</span>
</pre></div>
</div>
<p>これにより$GROONGA_CLONE_DIR/base_versionが更新されるのでコミットしておきます。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>base_versionはtar.gzなどのリリース用のファイル名で使用します。</p>
</div>
</div>
<div class="section" id="id28">
<h4><span class="section-number">12.3.7.3.29.2. </span>パッケージの署名用のパスフレーズを知りたい<a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h4>
<p>パッケージの署名に必要な秘密鍵のパスフレーズについては
リリース担当者向けの秘密鍵を復号したテキストの1行目に記載してあります。</p>
</div>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">12.3.7. リリース手順</a><ul>
<li><a class="reference internal" href="#id2">12.3.7.1. 前提条件</a></li>
<li><a class="reference internal" href="#id3">12.3.7.2. 最初の1回だけ行う手順</a><ul>
<li><a class="reference internal" href="#id4">12.3.7.2.1. ビルド環境の準備</a></li>
<li><a class="reference internal" href="#id5">12.3.7.2.2. パッケージ署名用秘密鍵のインポート</a></li>
<li><a class="reference internal" href="#ppa">12.3.7.2.3. PPA用の鍵の登録</a></li>
<li><a class="reference internal" href="#id6">12.3.7.2.4. リリース作業用ディレクトリの作成</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id7">12.3.7.3. 毎回のリリースで行う手順</a><ul>
<li><a class="reference internal" href="#groonga">12.3.7.3.1. Groongaのソースコード取得</a></li>
<li><a class="reference internal" href="#id8">12.3.7.3.2. Groongaのウェブサイトの取得</a></li>
<li><a class="reference internal" href="#cutter">12.3.7.3.3. cutterのソースコード取得</a></li>
<li><a class="reference internal" href="#configure">12.3.7.3.4. configureスクリプトの生成</a></li>
<li><a class="reference internal" href="#id9">12.3.7.3.5. configureスクリプトの実行</a></li>
<li><a class="reference internal" href="#id10">12.3.7.3.6. 変更点のまとめ</a></li>
<li><a class="reference internal" href="#make-update-latest-release">12.3.7.3.7. make update-latest-releaseの実行</a></li>
<li><a class="reference internal" href="#make-update-examples">12.3.7.3.8. make update-examplesの実行</a></li>
<li><a class="reference internal" href="#make-update-files">12.3.7.3.9. make update-filesの実行</a></li>
<li><a class="reference internal" href="#make-update-po">12.3.7.3.10. make update-poの実行</a></li>
<li><a class="reference internal" href="#po">12.3.7.3.11. poファイルの翻訳</a></li>
<li><a class="reference internal" href="#id11">12.3.7.3.12. 各種テストの確認</a></li>
<li><a class="reference internal" href="#id12">12.3.7.3.13. リリースタグの設定</a></li>
<li><a class="reference internal" href="#id13">12.3.7.3.14. リリース用アーカイブファイルの作成</a></li>
<li><a class="reference internal" href="#id14">12.3.7.3.15. リリース用アーカイブファイルのアップロード</a></li>
<li><a class="reference internal" href="#id15">12.3.7.3.16. パッケージのビルド</a></li>
<li><a class="reference internal" href="#debian">12.3.7.3.17. Debian系パッケージのビルドとアップロード</a></li>
<li><a class="reference internal" href="#ubuntu">12.3.7.3.18. Ubuntu用パッケージのアップロード</a><ul>
<li><a class="reference internal" href="#id16">12.3.7.3.18.1. Ubuntu用パッケージの公開の取り消し</a></li>
</ul>
</li>
<li><a class="reference internal" href="#red-hat">12.3.7.3.19. Red Hat系パッケージのビルドとアップロード</a></li>
<li><a class="reference internal" href="#windows">12.3.7.3.20. Windows用パッケージのビルドとアップロード</a></li>
<li><a class="reference internal" href="#id17">12.3.7.3.21. パッケージの動作確認</a><ul>
<li><a class="reference internal" href="#grntest">12.3.7.3.21.1. grntestの準備</a></li>
<li><a class="reference internal" href="#id18">12.3.7.3.21.2. grntestの実行方法</a></li>
<li><a class="reference internal" href="#id19">12.3.7.3.21.3. Debian系の場合</a></li>
<li><a class="reference internal" href="#id20">12.3.7.3.21.4. Red Hat系の場合</a></li>
<li><a class="reference internal" href="#id21">12.3.7.3.21.5. Windows向けの場合</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id22">12.3.7.3.22. リリースアナウンスの作成</a></li>
<li><a class="reference internal" href="#blogroonga">12.3.7.3.23. blogroonga(ブログ)の更新</a></li>
<li><a class="reference internal" href="#id23">12.3.7.3.24. ドキュメントのアップロード</a></li>
<li><a class="reference internal" href="#homebrew">12.3.7.3.25. Homebrewの更新</a></li>
<li><a class="reference internal" href="#id25">12.3.7.3.26. リリースアナウンス</a></li>
<li><a class="reference internal" href="#twitter">12.3.7.3.27. Twitterでリリースアナウンスをする</a></li>
<li><a class="reference internal" href="#facebook">12.3.7.3.28. Facebookでリリースアナウンスをする</a></li>
<li><a class="reference internal" href="#id26">12.3.7.3.29. リリース後にやること</a><ul>
<li><a class="reference internal" href="#id27">12.3.7.3.29.1. Groonga バージョン更新</a></li>
<li><a class="reference internal" href="#id28">12.3.7.3.29.2. パッケージの署名用のパスフレーズを知りたい</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="query.html"
                        title="previous chapter"><span class="section-number">12.3.5. </span>クエリの実現</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="test.html"
                        title="next chapter"><span class="section-number">12.3.8. </span>テスト方法</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="test.html" title="12.3.8. テスト方法"
             >next</a> |</li>
        <li class="right" >
          <a href="query.html" title="12.3.5. クエリの実現"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Groonga v11.0.9 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../contribution.html" ><span class="section-number">12. </span>How to contribute to groonga</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../development.html" ><span class="section-number">12.3. </span>For Groonga developers</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">12.3.7. </span>リリース手順</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2009-2021, Brazil, Inc.
    </div>
      <script src="http://connect.facebook.net/en_US/all.js"></script>

    <script>
      FB.init({
         appId  : null,
         status : true, // check login status
         cookie : true, // enable cookies to allow the server to access the session
         xfbml  : true  // parse XFBML
      });
    </script>
  </body>

</html>