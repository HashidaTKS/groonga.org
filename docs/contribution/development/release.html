<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>12.2.5. リリース手順 &mdash; groonga v2.0.5-49-gef0de04 documentation</title>
    
    <link rel="stylesheet" href="../../static/groonga.css" type="text/css" />
    <link rel="stylesheet" href="../../static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.0.5-49-gef0de04',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../static/jquery.js"></script>
    <script type="text/javascript" src="../../static/underscore.js"></script>
    <script type="text/javascript" src="../../static/doctools.js"></script>
    <link rel="shortcut icon" href="../../static/favicon.ico"/>
    <link rel="top" title="groonga v2.0.5-49-gef0de04 documentation" href="../../index.html" />
    <link rel="up" title="12.2. groonga開発者向け情報" href="../development.html" />
    <link rel="next" title="12.2.6. テスト方法" href="test.html" />
    <link rel="prev" title="12.2.3. クエリの実現" href="query.html" /> 
      <meta property="fb:page_id" content="201193596592346" /><!-- groonga -->
    <meta property="fb:admins" content="664204556" /><!-- kouhei.sutou -->
    <meta property="og:type" content="product" />
    <meta property="og:image" content="http://groonga.org/images/logos/groonga-icon-full-size.png" />
    <meta property="og:site_name" content="groonga" />

    <link rel="stylesheet" href="/css/sphinx.css" type="text/css" />
  </head>

    <body>
    <div id="fb-root"></div>

<div class="header">
  <h1 class="title">
    <a id="top-link" href="../../../">
      <span class="project">groonga</span>
      <span class="separator">-</span>
      <span class="description">An open-source fulltext search engine and column store.</span>
    </a>
  </h1>

      <div class="facebook-buttons">
      <fb:like href="http://www.facebook.com/pages/groonga/201193596592346"
               layout="standard"
               width="290"></fb:like>
    </div>
    <div class="other-language-links">

    <ul>
      <li><a href="../../../ja/docs/contribution/development/release.html"><img src="../../static/jp.png" alt="日本語">日本語版はこちら</a></li>
    </ul>
  </div>
</div>
  

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="test.html" title="12.2.6. テスト方法"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="query.html" title="12.2.3. クエリの実現"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">groonga v2.0.5-49-gef0de04 documentation</a> &raquo;</li>
          <li><a href="../../contribution.html" >12. How to contribute to groonga</a> &raquo;</li>
          <li><a href="../development.html" accesskey="U">12.2. groonga開発者向け情報</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="id1">
<h1>12.2.5. リリース手順<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id2">
<h2>12.2.5.1. ビルド環境の準備<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>以下にgroongaのリリース作業を行うために事前にインストール
しておくべきパッケージを示します。</p>
<p>なお、ビルド環境としては Ubuntu 12.04 LTS(Precise Pangolin)を前提とし
て説明しています。その他の環境では適宜読み替えて下さい。:</p>
<div class="highlight-none"><div class="highlight"><pre>% sudo apt-get install -V debootstrap rinse createrepo rpm
mercurial python-sphinx ruby1.9.1-full mingw-w64 g++-mingw-w64 mecab libmecab-dev nsis gnupg2
</pre></div>
</div>
<p>rinseのバージョンが古いとCentOS 5/6パッケージのビルドを行うことができ
ません。
別途debパッケージを以下のコマンドを実行して最新版をインストールしま
す。:</p>
<div class="highlight-none"><div class="highlight"><pre>% sudo dpkg -i rinse_1.9.2-1_all.deb
</pre></div>
</div>
<p>また、rubyのrakeパッケージを以下のコマンドによりインストールします。:</p>
<div class="highlight-none"><div class="highlight"><pre>% sudo gem1.9.1 install rake
</pre></div>
</div>
<p>なお、特に明記していない限り本リリース手順でのコマンドラインの
操作はzshを前提としています。</p>
</div>
<div class="section" id="id3">
<h2>12.2.5.2. リリース作業用ディレクトリの作成<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>groongaのリリース作業ではリリース専用の環境下(コンパイルフラグ)でビルド
する必要があります。</p>
<p>リリース時と開発時でディレクトリを分けずに作業することもできますが、
誤ったコンパイルフラグでリリースしてしまう危険があります。</p>
<p>そのため、以降の説明では$(HOME)/work/groonga以下のディレクトリに
リリース用の作業ディレクトリ(groonga.clean)にソースコードを
cloneしたものとして説明します。</p>
<p>リリース用のクリーンな状態でソースコードをgroonga.cleanディレ
クトリに取得するために以下のコマンドを実行します。:</p>
<div class="highlight-none"><div class="highlight"><pre>% git clone git@github.com:groonga/groonga.git groonga.clean
</pre></div>
</div>
<p>この作業は初回のリリース作業のときに必要です。</p>
</div>
<div class="section" id="id4">
<h2>12.2.5.3. パッケージ署名用秘密鍵のインポート<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>リリース作業ではRPMパッケージに対する署名を行います。
その際、パッケージ署名用の鍵が必要です。</p>
<p>groongaプロジェクトでは署名用の鍵をリリース担当者の公開鍵で
暗号化してリポジトリのpackages/ディレクトリ以下へと登録しています。</p>
<p>リリース担当者はリポジトリに登録された秘密鍵を復号した後に
鍵のインポートを以下のコマンドにて行います。:</p>
<div class="highlight-none"><div class="highlight"><pre>% cd packages
% gpg --decrypt release-key-secret.asc.gpg.(担当者) &gt; (復号した鍵
ファイル)
% gpg --import  (復号した鍵ファイル)
</pre></div>
</div>
<p>鍵のインポートが正常終了すると gpg --list-keys でgroongaの署名用の
鍵を確認することができます。:</p>
<div class="highlight-none"><div class="highlight"><pre>pub   1024R/F10399C0 2012-04-24
uid                  groonga Key (groonga Official Signing Key)
&lt;packages@groonga.org&gt;
sub   1024R/BC009774 2012-04-24
</pre></div>
</div>
<p>鍵をインポートしただけでは使用することができないため、インポートした鍵
に対してtrust,signを行う必要があります。</p>
<p>以下のコマンドを実行して署名を行います。(途中の選択肢は省略):</p>
<div class="highlight-none"><div class="highlight"><pre>% gpg --edit-key packages@groonga.org
gpg&gt; trust
gpg&gt; sign
gpg&gt; save
gpg&gt; quit
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h2>12.2.5.4. 変更点のまとめ<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>前回リリース時からの変更点をdoc/source/news.txtにまとめます。
ここでまとめた内容についてはリリースアナウンスにも使用します。</p>
<p>前回リリースからの変更履歴を参照するには以下のコマンドを実行します。:</p>
<div class="highlight-none"><div class="highlight"><pre>% git log -p --reverse $(git tag | tail -1)..
</pre></div>
</div>
<p>ログを^commitで検索しながら、以下の基準を目安として変更点を追記してい
きます。</p>
<p>含めるもの</p>
<ul class="simple">
<li>ユーザへ影響するような変更</li>
<li>互換性がなくなるような変更</li>
</ul>
<p>含めないもの</p>
<ul class="simple">
<li>内部的な変更(変数名の変更やらリファクタリング)</li>
</ul>
</div>
<div class="section" id="groonga">
<h2>12.2.5.5. groongaのウェブサイトの取得<a class="headerlink" href="#groonga" title="Permalink to this headline">¶</a></h2>
<p>groongaのウェブサイトのソースはgroonga同様にgithubにリポジトリを置いて
います。</p>
<p>リリース作業では後述するコマンド(make update-latest-release)にてトップページのバージョンを
置き換えることができるようになっています。</p>
<p>groongaのウェブサイトのソースコードは以下コマンドにてのように取得します。:</p>
<div class="highlight-none"><div class="highlight"><pre>% git clone git@github.com:groonga/groonga.github.com.git
</pre></div>
</div>
<p>これで、~/work/groonga/groonga.github.comにソースを取得できます。</p>
</div>
<div class="section" id="configure">
<h2>12.2.5.6. configureスクリプトの生成<a class="headerlink" href="#configure" title="Permalink to this headline">¶</a></h2>
<p>ソースコードをcloneした時点ではconfigureスクリプトが含まれておらず
そのままmakeコマンドにてビルドすることができません。</p>
<p>groongaのリリース作業ディレクトリでautogen.shを以下のように実行します。:</p>
<div class="highlight-none"><div class="highlight"><pre>% sh autogen.sh
</pre></div>
</div>
<p>このコマンドの実行により、configureスクリプトが生成されます。</p>
</div>
<div class="section" id="id6">
<h2>12.2.5.7. configureスクリプトの実行<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<p>Makefileを生成するためにconfigureスクリプトを実行します。</p>
<p>リリース用にビルドするためには以下のオプションを指定してconfigureを実行し
ます。:</p>
<div class="highlight-none"><div class="highlight"><pre>% ./configure CFLAGS=&quot;-O0 -ggdb3&quot; CXXFLAGS=&quot;-O0 -ggdb3&quot; --prefix=/tmp/local --with-rsync-path=&quot;packages@packages.groonga.org:public&quot; --with-groonga-github-com-path=$HOME/work/groonga/groonga.github.com --enable-document --with-ruby19
</pre></div>
</div>
<p>configureオプションである--with-groonga-github-com-pathにはgroongaのウェ
ブサイトのリポジトリをcloneした場所を指定します。</p>
<p>以下のようにgroongaのソースコードをcloneした先からの相対パスを指定することもできます。:</p>
<div class="highlight-none"><div class="highlight"><pre>% ./configure CFLAGS=&quot;-O0 -ggdb3&quot; CXXFLAGS=&quot;-O0 -ggdb3&quot; --prefix=/tmp/local --with-rsync-path=&quot;packages@packages.groonga.org:public&quot; --with-groonga-github-com-path=../groonga.github.com --enable-document --with-ruby19
</pre></div>
</div>
<p>あらかじめpackagesユーザでpackages.groonga.orgにsshログインできることを
確認しておいてください。</p>
<p>ログイン可能であるかの確認は以下のようにコマンドを実行して行います。:</p>
<div class="highlight-none"><div class="highlight"><pre>% ssh packages@packages.groonga.org
</pre></div>
</div>
</div>
<div class="section" id="make-update-latest-release">
<h2>12.2.5.8. make update-latest-releaseの実行<a class="headerlink" href="#make-update-latest-release" title="Permalink to this headline">¶</a></h2>
<p>make update-latest-releaseコマンドでは、
OLD_RELEASE_DATEに前回のリリースの日付を、NEW_RELEASE_DATEに次回リリー
スの日付を指定します。</p>
<p>2.0.2のリリースを行った際は以下のコマンドを実行しました。::</p>
<div class="highlight-none"><div class="highlight"><pre>% make update-latest-release OLD_RELEASE=2.0.1 OLD_RELEASE_DATE=2012-03-29 NEW_RELEASE_DATE=2012-04-29
</pre></div>
</div>
<p>これにより、clone済みのgroongaのWebサイトのトップページのソース
(index.html,ja/index.html)やRPMパッケージのspecファイルのバージョン表記などが更新されます。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">このとき更新されるspecファイルは現在リリースする人の名前が固定となっているのでリリース作業後にカスタマイズ指定可能なように修正を入れる</p>
</div>
</div>
<div class="section" id="make-update-files">
<h2>12.2.5.9. make update-filesの実行<a class="headerlink" href="#make-update-files" title="Permalink to this headline">¶</a></h2>
<p>ロケールメッセージの更新や変更されたファイルのリスト等を更新するために
以下のコマンドを実行します。(このコマンドを実行するにはあらかじめ
sphinxのインストールが必要です。):</p>
<div class="highlight-none"><div class="highlight"><pre>% make update-files
</pre></div>
</div>
<p>make update-filesを実行すると新規に追加されたファイルなどが
各種.amファイルへとリストアップされます。</p>
<p>リリースに必要なファイルですので漏れなくコミットします。</p>
</div>
<div class="section" id="make-update-po">
<h2>12.2.5.10. make update-poの実行<a class="headerlink" href="#make-update-po" title="Permalink to this headline">¶</a></h2>
<p>ドキュメントの最新版と各国語版の内容を同期するために、
poファイルの更新を以下のコマンドにて実行します。:</p>
<div class="highlight-none"><div class="highlight"><pre>% make update-po
</pre></div>
</div>
<p>make update-poを実行すると、doc/locale/ja/LC_MESSAGES以下の各種.poファ
イルが更新されます。</p>
</div>
<div class="section" id="po">
<h2>12.2.5.11. poファイルの翻訳<a class="headerlink" href="#po" title="Permalink to this headline">¶</a></h2>
<p>make update-poコマンドの実行により更新した各種.poファイルを翻訳します。</p>
<p>翻訳結果をHTMLで確認するために、以下のコマンドを実行します。:</p>
<div class="highlight-none"><div class="highlight"><pre>% make -C doc/locale/ja html
% make -C doc/locale/en html
</pre></div>
</div>
<p>確認が完了したら、翻訳済みpoファイルをコミットします。</p>
</div>
<div class="section" id="id7">
<h2>12.2.5.12. リリース用アーカイブファイルの作成<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<p>リリース用のソースアーカイブファイルを作成するために
以下のコマンドをgroonga.clean直下で実行します。:</p>
<div class="highlight-none"><div class="highlight"><pre>% make dist
</pre></div>
</div>
<p>これによりgroonga.clean/groonga-(バージョン).tar.gzが作成されます。</p>
</div>
<div class="section" id="id8">
<h2>12.2.5.13. パッケージのビルド<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h2>
<p>リリース用のアーカイブファイルができたので、
パッケージ化する作業を行います。</p>
<p>パッケージ化作業は以下の3種類を対象に行います。</p>
<ul class="simple">
<li>Debian系(.deb)</li>
<li>Red Hat系(.rpm)</li>
<li>Windows系(.exe,.zip)</li>
</ul>
<p>パッケージのビルドではいくつかのサブタスクから構成されています。</p>
<div class="section" id="id9">
<h3>12.2.5.13.1. ビルド用パッケージのダウンロード<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>debパッケージのビルドに必要なパッケージをダウンロードするには
以下のコマンドを実行します。:</p>
<div class="highlight-none"><div class="highlight"><pre>% cd packages/apt
% make download
</pre></div>
</div>
<p>これにより、lucid以降の関連する.debパッケージやソースアーカイブなどがカ
レントディレクトリ以下へとダウンロードされます。</p>
<p>rpmパッケージのビルドに必要なパッケージをダウンロードするには
以下のコマンドを実行します。:</p>
<div class="highlight-none"><div class="highlight"><pre>% cd packages/yum
% make download
</pre></div>
</div>
<p>これにより、groongaやMySQLのRPM/SRPMパッケージなどがカレントディレクト
リ以下へとダウンロードされます。</p>
<p>windowsパッケージのビルドに必要なパッケージをダウンロードするには
以下のコマンドを実行します。:</p>
<div class="highlight-none"><div class="highlight"><pre>% cd packages/windows
% make download
</pre></div>
</div>
<p>これにより、groongaのインストーラやzipアーカイブがカレントディレクトリ
以下へとダウンロードされます。</p>
<p>sourceパッケージに必要なものをダウンロードするには以下のコマンドを
実行します。:</p>
<div class="highlight-none"><div class="highlight"><pre>% cd packages/source
% make download
</pre></div>
</div>
<p>これにより過去にリリースしたソースアーカイブ(.tar.gz)が
packages/source/filesディレクトリ以下へとダウンロードされます。</p>
</div>
</div>
<div class="section" id="debian">
<h2>12.2.5.14. Debian系パッケージのビルド<a class="headerlink" href="#debian" title="Permalink to this headline">¶</a></h2>
<p>groongaのpackages/aptサブディレクトリに移動して、以下のコマンドを実行します。:</p>
<div class="highlight-none"><div class="highlight"><pre>% cd packages/apt
% make build PALALLEL=yes
</pre></div>
</div>
<p>make build PALALLEL=yesコマンドを実行すると、ディストリビューションの
リリースとアーキテクチャの組み合わせでビルドを平行して行うことができま
す。</p>
<p>現在サポートされているのは以下の通りです。</p>
<ul class="simple">
<li>squeeze i386/amd64</li>
<li>wheezy i386/amd64</li>
<li>unstable i386/amd64</li>
<li>lucid i386/amd64</li>
<li>natty i386/amd64</li>
<li>oneiric i386/amd64</li>
<li>precise i386/amd64</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">unstable i386/amd64はpreciseに構築したchroot環境ではパッケージのビ
ルドが行えることを確認できていないことに注意。</p>
</div>
<p>正常にビルドが終了すると以下のディレクトリへと.debパッケージが生成され
ます。</p>
<ul class="simple">
<li>packages/apt/packages/debian/pool/squeeze/main/g/groonga</li>
</ul>
<p>make build ですんなりビルドできないこともあります。
その場合にはbuildのサブタスクであるbuild-package-debと
build-repository-debを個別に実行して問題が発生している箇所を切り分ける
必要があります。</p>
<p>生成したパッケージへの署名を行うには以下のコマンドを実行します。:</p>
<div class="highlight-none"><div class="highlight"><pre>% make sign-packages
</pre></div>
</div>
<p>リリース対象のファイルをリポジトリに反映するには以下のコマンドを実行します。:</p>
<div class="highlight-none"><div class="highlight"><pre>% make update-repository
</pre></div>
</div>
<p>リポジトリにGnuPGで署名を行うために以下のコマンドを実行します。:</p>
<div class="highlight-none"><div class="highlight"><pre>% make sign-repository
</pre></div>
</div>
</div>
<div class="section" id="red-hat">
<h2>12.2.5.15. Red Hat系パッケージのビルド<a class="headerlink" href="#red-hat" title="Permalink to this headline">¶</a></h2>
<p>groongaのpackages/yumサブディレクトリに移動して、以下のコマンドを実行します。:</p>
<div class="highlight-none"><div class="highlight"><pre>% cd packages/yum
% make build PALALLES=yes
</pre></div>
</div>
<p>make build PALALLEL=yesコマンドを実行すると、ディストリビューションの
リリースとアーキテクチャの組み合わせでビルドを平行して行うことができま
す。</p>
<p>現在サポートされているのは以下の通りです。</p>
<ul class="simple">
<li>centos-5 i386/x86_64</li>
<li>centos-6 i386/x86_64</li>
<li>fedora-16 i386/x86_64</li>
</ul>
<p>ビルドが正常終了すると以下のディレクトリにRPMが生成されます。</p>
<ul class="simple">
<li>packages/yum/centos/5/i386/Packages</li>
<li>packages/yum/centos/5/x86_64/Packages</li>
<li>packages/yum/centos/6/i386/Packages</li>
<li>packages/yum/centos/6/x86_64/Packages</li>
<li>packages/yum/fedora/16/i386/Packages</li>
<li>packages/yum/fedora/16/x86_64/Packages</li>
</ul>
<p>リポジトリを作成するには以下のコマンドを実行します。:</p>
<div class="highlight-none"><div class="highlight"><pre>% make build
</pre></div>
</div>
<p>リリース対象のRPMに署名を行うには以下のコマンドを実行します。:</p>
<div class="highlight-none"><div class="highlight"><pre>% make sign
</pre></div>
</div>
<p>リリース対象のファイルをリポジトリに反映するには以下のコマンドを実行します。:</p>
<div class="highlight-none"><div class="highlight"><pre>% make update
</pre></div>
</div>
</div>
<div class="section" id="windows">
<h2>12.2.5.16. Windows用パッケージのビルド<a class="headerlink" href="#windows" title="Permalink to this headline">¶</a></h2>
<p>packages/windowsサブディレクトリに移動して、以下のコマンドを実行します。:</p>
<div class="highlight-none"><div class="highlight"><pre>% cd packages/windows
% make build
% make package
% make installer
</pre></div>
</div>
<p>make releaseを実行することでbuildからuploadまで一気に実行することがで
きますが、途中で失敗することもあるので順に実行することをおすすめします。</p>
<p>make buildでクロスコンパイルを行います。
正常に終了するとdist-x64/dist-x86ディレクトリ以下にx64/x86バイナリを作成します。</p>
<p>make packageが正常に終了するとzipアーカイブをfilesディレクトリ以下に作成します。</p>
<p>make installerが正常に終了するとWindowsインストーラをfilesディレクトリ以
下に作成します。</p>
</div>
<div class="section" id="id10">
<h2>12.2.5.17. パッケージの動作確認<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h2>
<p>ビルドしたパッケージに対しリリース前の動作確認を行います。</p>
<p>Debian系もしくはRed Hat系の場合には本番環境へとアップロードする前に
ローカルのaptないしyumのリポジトリを参照して正常に更新できることを
確認します。</p>
<p>ここでは以下のようにrubyを利用してリポジトリをwebサーバ経由で
参照できるようにします。:</p>
<div class="highlight-none"><div class="highlight"><pre>% ruby1.9.1 -run -e httpd -- packages/yum/repositories (yumの場合)
% ruby1.9.1 -run -e httpd -- packages/apt/repositories (aptの場合)
</pre></div>
</div>
<div class="section" id="grntest">
<h3>12.2.5.17.1. grntestの準備<a class="headerlink" href="#grntest" title="Permalink to this headline">¶</a></h3>
<p>grntestを実行するためにはgroongaのテストデータとgrntestのソースが
必要です。</p>
<p>まずgroongaのソースを任意のディレクトリへと展開します。:</p>
<div class="highlight-none"><div class="highlight"><pre>% tar zxvf groonga-(バージョン).tar.gz
</pre></div>
</div>
<p>次にgroongaのtest/functionディレクトリ以下にgrntestのソースを展開します。
つまりtest/function/grntestという名前でgrntestのソースを配置します。:</p>
<div class="highlight-none"><div class="highlight"><pre>% ls test/function/grntest/
README.md  binlib  license  test
</pre></div>
</div>
</div>
<div class="section" id="id11">
<h3>12.2.5.17.2. grntestの実行方法<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>grntestではgroongaコマンドを明示的にしていすることができます。
後述のパッケージごとのgrntestによる動作確認では以下のようにして
実行します。:</p>
<div class="highlight-none"><div class="highlight"><pre>% GROONGA=(groongaのパス指定) test/function/run-test.sh
</pre></div>
</div>
<p>最後にgrntestによる実行結果が以下のようにまとめて表示されます。:</p>
<div class="highlight-none"><div class="highlight"><pre>55 tests, 52 passes, 0 failures, 3 not checked tests.
94.55% passed.
</pre></div>
</div>
<p>grntestでエラーが発生しないことを確認します。</p>
</div>
<div class="section" id="id12">
<h3>12.2.5.17.3. Debian系の場合<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>Debian系の場合の動作確認手順は以下の通りとなります。</p>
<ul class="simple">
<li>旧バージョンをchroot環境へとインストールする</li>
<li>chroot環境の/etc/hostsを書き換えてpackages.groonga.orgがホストを
参照するように変更する</li>
<li>ホストでwebサーバを起動してドキュメントルートをビルド環境のもの
(packages/apt/packages)に設定する</li>
<li>アップグレード手順を実行する</li>
<li>grntestのアーカイブを展開してインストールしたバージョンでテストを実
行する</li>
<li>grntestの正常終了を確認する</li>
</ul>
</div>
<div class="section" id="id13">
<h3>12.2.5.17.4. Red Hat系の場合<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<p>Red Hat系の場合の動作確認手順は以下の通りとなります。</p>
<ul class="simple">
<li>旧バージョンをchroot環境へとインストール</li>
<li>chroot環境の/etc/hostsを書き換えてpackages.groonga.orgがホストを
参照するように変更する</li>
<li>ホストでwebサーバを起動してドキュメントルートをビルド環境のもの
(packages/yum)に設定する</li>
<li>アップグレード手順を実行する</li>
<li>grntestのアーカイブを展開してインストールしたバージョンでテストを実
行する</li>
<li>grntestの正常終了を確認する</li>
</ul>
</div>
<div class="section" id="id14">
<h3>12.2.5.17.5. Windows向けの場合<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>新規インストール/上書きインストールを行う</li>
<li>grntestのアーカイブを展開してインストールしたバージョンでテストを実
行する</li>
<li>grntestの正常終了を確認する</li>
</ul>
<p>zipアーカイブも同様にしてgrntestを実行し動作確認を行います。</p>
</div>
</div>
<div class="section" id="id15">
<h2>12.2.5.18. リリースアナウンスの作成<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h2>
<p>リリースの際にはリリースアナウンスを流して、
groongaを広く通知します。</p>
<p>news.txtに変更点をまとめましたが、それを元にリリースアナウンスを
作成します。</p>
<p>リリースアナウンスには以下を含めます。</p>
<ul class="simple">
<li>インストール方法へのリンク</li>
<li>リリースのトピック紹介</li>
<li>リリース変更点へのリンク</li>
<li>リリース変更点(news.txtの内容)</li>
</ul>
<p>リリースのトピック紹介では、これからgroongaを使う人へアピールする点や
既存のバージョンを利用している人がアップグレードする際に必要な
情報を提供します。</p>
<p>非互換な変更が含まれるのであれば、回避方法等の案内を載せることも重要で
す。</p>
<p>参考までに過去のリリースアナウンスへのリンクを以下に示します。</p>
<ul>
<li><p class="first">[Groonga-talk] [ANN] groonga 2.0.2</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="http://sourceforge.net/mailarchive/message.php?msg_id=29195195">http://sourceforge.net/mailarchive/message.php?msg_id=29195195</a></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">[groonga-dev,00794] [ANN] groonga 2.0.2</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="http://sourceforge.jp/projects/groonga/lists/archive/dev/2012-April/000794.html">http://sourceforge.jp/projects/groonga/lists/archive/dev/2012-April/000794.html</a></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="id16">
<h2>12.2.5.19. パッケージのアップロード<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h2>
<p>動作確認が完了し、Debian系、Red Hat系、Windows向け、ソースコードそ
れぞれにおいてパッケージやアーカイブのアップロードを行います。</p>
<p>Debian系のパッケージのアップロードには以下のコマンドを実行します。:</p>
<div class="highlight-none"><div class="highlight"><pre>% cd packages/apt
% make upload
</pre></div>
</div>
<p>Red Hat系のパッケージのアップロードには以下のコマンドを実行します。:</p>
<div class="highlight-none"><div class="highlight"><pre>% cd packages/yum
% make upload
</pre></div>
</div>
<p>Windows向けのパッケージのアップロードには以下のコマンドを実行します。:</p>
<div class="highlight-none"><div class="highlight"><pre>% cd packages/windows
% make upload
</pre></div>
</div>
<p>ソースアーカイブのアップロードには以下のコマンドを実行します。:</p>
<div class="highlight-none"><div class="highlight"><pre>% cd packages/source
% make upload
</pre></div>
</div>
<p>アップロードが正常終了すると、リリース対象のリポジトリデータやパッケージ、アーカイブ
等がpackages.groonga.orgへと反映されます。</p>
</div>
<div class="section" id="blogroonga">
<h2>12.2.5.20. blogroonga(ブログ)の更新<a class="headerlink" href="#blogroonga" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://groonga.org/blog/">http://groonga.org/blog/</a> および <a class="reference external" href="http://groonga.org/blog/">http://groonga.org/blog/</a> にて
公開されているリリース案内を作成します。</p>
<p>基本的にはリリースアナウンスの内容をそのまま記載します。</p>
<p>cloneしたWebサイトのソースに対して以下のファイルを新規追加します。</p>
<ul class="simple">
<li>groonga.github.com/en/_post/(リリース日)-release.textile</li>
<li>groonga.github.com/ja/_post/(リリース日)-release.textile</li>
</ul>
<p>編集した内容をpushする前に確認したい場合にはjekyllおよび
RedClothが必要です。
インストールするには以下のコマンドを実行します。:</p>
<div class="highlight-none"><div class="highlight"><pre>% sudo gem1.9.1 install jekyll RedCloth
</pre></div>
</div>
<p>jekyllのインストールを行ったら、以下のコマンドでローカルにwebサーバを
起動します。:</p>
<div class="highlight-none"><div class="highlight"><pre>% jekyll --server --auto
</pre></div>
</div>
<p>あとはブラウザにてhttp://localhost:4000にアクセスして内容に問題がない
かを確認します。</p>
</div>
<div class="section" id="id17">
<h2>12.2.5.21. ドキュメントのアップロード<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h2>
<p>doc/source以下のドキュメントを更新、翻訳まで完了している状態で、
ドキュメントのアップロード作業を行います。</p>
<p>そのためにはまず以下のコマンドを実行します。:</p>
<div class="highlight-none"><div class="highlight"><pre>% make update-document
</pre></div>
</div>
<p>これによりcloneしておいたgroonga.github.comのdoc/locale以下に更新した
ドキュメントがコピーされます。</p>
<p>生成されているドキュメントに問題のないことを確認できたら、
コミット、pushしてgroonga.orgへと反映します。</p>
</div>
<div class="section" id="id18">
<h2>12.2.5.22. リリースアナウンス<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h2>
<p>作成したリリースアナウンスをメーリングリストへと流します。</p>
<ul class="simple">
<li>groonga-dev <a class="reference external" href="mailto:groonga-dev&#37;&#52;&#48;lists&#46;sourceforge&#46;jp">groonga-dev<span>&#64;</span>lists<span>&#46;</span>sourceforge<span>&#46;</span>jp</a></li>
<li>Groonga-talk <a class="reference external" href="mailto:groonga-talk&#37;&#52;&#48;lists&#46;sourceforge&#46;net">groonga-talk<span>&#64;</span>lists<span>&#46;</span>sourceforge<span>&#46;</span>net</a></li>
</ul>
<p>以上でリリース作業は終了です。</p>
</div>
<div class="section" id="tips">
<h2>12.2.5.23. ビルド時のTIPS<a class="headerlink" href="#tips" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id19">
<h3>12.2.5.23.1. ビルドを並列化したい<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h3>
<p>make build PALALLES=yesを指定するとchroot環境で並列にビルドを
実行できます。</p>
</div>
<div class="section" id="id20">
<h3>12.2.5.23.2. 特定の環境向けのみビルドしたい<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h3>
<p>Debian系の場合、CODES,ARCHITECTURESオプションを明示的に指定することで、
特定のリリース、アーキテクチャのみビルドすることができます。</p>
<p>squeezeのi386のみビルドしたい場合には以下のコマンドを実行します。:</p>
<div class="highlight-none"><div class="highlight"><pre>% make build ARCHITECTURES=i386 CODES=squeeze
</pre></div>
</div>
<p>buildコマンド以外でも build-package-deb build-repository-debなどの
サブタスクでもARCHITECTURES,CODES指定は有効です。</p>
<p>Red Hat系の場合、ARCHITECTURES,DISTRIBUTIONSオプションを明示的に指定す
ることで、特定のリリース、アーキテクチャのみビルドすることができます。</p>
<p>fedoraのi386のみビルドしたい場合には以下のコマンドを実行します。:</p>
<div class="highlight-none"><div class="highlight"><pre>% make build ARCHITECTURES=i386 DISTRIBUTIONS=fedora
</pre></div>
</div>
<p>buildコマンド以外でも build-in-chroot build-repository-rpmなどの
サブタスクでもARCHITECTURES,DISTRIBUTIONSの指定は有効です。</p>
<p>ただし、centosの場合 バージョンまで明示して5のみビルドや6のみビルド
することはできません。まとめてcentosとしてビルドされます。</p>
</div>
<div class="section" id="id21">
<h3>12.2.5.23.3. パッケージの署名用のパスフレーズを知りたい<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h3>
<p>パッケージの署名に必要な秘密鍵のパスフレーズについては
リリース担当者向けの秘密鍵を復号したテキストの1行目に記載してあります。</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">12.2.5. リリース手順</a><ul>
<li><a class="reference internal" href="#id2">12.2.5.1. ビルド環境の準備</a></li>
<li><a class="reference internal" href="#id3">12.2.5.2. リリース作業用ディレクトリの作成</a></li>
<li><a class="reference internal" href="#id4">12.2.5.3. パッケージ署名用秘密鍵のインポート</a></li>
<li><a class="reference internal" href="#id5">12.2.5.4. 変更点のまとめ</a></li>
<li><a class="reference internal" href="#groonga">12.2.5.5. groongaのウェブサイトの取得</a></li>
<li><a class="reference internal" href="#configure">12.2.5.6. configureスクリプトの生成</a></li>
<li><a class="reference internal" href="#id6">12.2.5.7. configureスクリプトの実行</a></li>
<li><a class="reference internal" href="#make-update-latest-release">12.2.5.8. make update-latest-releaseの実行</a></li>
<li><a class="reference internal" href="#make-update-files">12.2.5.9. make update-filesの実行</a></li>
<li><a class="reference internal" href="#make-update-po">12.2.5.10. make update-poの実行</a></li>
<li><a class="reference internal" href="#po">12.2.5.11. poファイルの翻訳</a></li>
<li><a class="reference internal" href="#id7">12.2.5.12. リリース用アーカイブファイルの作成</a></li>
<li><a class="reference internal" href="#id8">12.2.5.13. パッケージのビルド</a><ul>
<li><a class="reference internal" href="#id9">12.2.5.13.1. ビルド用パッケージのダウンロード</a></li>
</ul>
</li>
<li><a class="reference internal" href="#debian">12.2.5.14. Debian系パッケージのビルド</a></li>
<li><a class="reference internal" href="#red-hat">12.2.5.15. Red Hat系パッケージのビルド</a></li>
<li><a class="reference internal" href="#windows">12.2.5.16. Windows用パッケージのビルド</a></li>
<li><a class="reference internal" href="#id10">12.2.5.17. パッケージの動作確認</a><ul>
<li><a class="reference internal" href="#grntest">12.2.5.17.1. grntestの準備</a></li>
<li><a class="reference internal" href="#id11">12.2.5.17.2. grntestの実行方法</a></li>
<li><a class="reference internal" href="#id12">12.2.5.17.3. Debian系の場合</a></li>
<li><a class="reference internal" href="#id13">12.2.5.17.4. Red Hat系の場合</a></li>
<li><a class="reference internal" href="#id14">12.2.5.17.5. Windows向けの場合</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id15">12.2.5.18. リリースアナウンスの作成</a></li>
<li><a class="reference internal" href="#id16">12.2.5.19. パッケージのアップロード</a></li>
<li><a class="reference internal" href="#blogroonga">12.2.5.20. blogroonga(ブログ)の更新</a></li>
<li><a class="reference internal" href="#id17">12.2.5.21. ドキュメントのアップロード</a></li>
<li><a class="reference internal" href="#id18">12.2.5.22. リリースアナウンス</a></li>
<li><a class="reference internal" href="#tips">12.2.5.23. ビルド時のTIPS</a><ul>
<li><a class="reference internal" href="#id19">12.2.5.23.1. ビルドを並列化したい</a></li>
<li><a class="reference internal" href="#id20">12.2.5.23.2. 特定の環境向けのみビルドしたい</a></li>
<li><a class="reference internal" href="#id21">12.2.5.23.3. パッケージの署名用のパスフレーズを知りたい</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="query.html"
                        title="previous chapter">12.2.3. クエリの実現</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="test.html"
                        title="next chapter">12.2.6. テスト方法</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../sources/contribution/development/release.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="test.html" title="12.2.6. テスト方法"
             >next</a> |</li>
        <li class="right" >
          <a href="query.html" title="12.2.3. クエリの実現"
             >previous</a> |</li>
        <li><a href="../../index.html">groonga v2.0.5-49-gef0de04 documentation</a> &raquo;</li>
          <li><a href="../../contribution.html" >12. How to contribute to groonga</a> &raquo;</li>
          <li><a href="../development.html" >12.2. groonga開発者向け情報</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009-2012, Brazil, Inc.
    </div>
      <script src="http://connect.facebook.net/en_US/all.js"></script>

    <script>
      FB.init({
         appId  : null,
         status : true, // check login status
         cookie : true, // enable cookies to allow the server to access the session
         xfbml  : true  // parse XFBML
      });
    </script>
  </body>

</html>